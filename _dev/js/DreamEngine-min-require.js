/*
 ___ ___ ___ ___ ___ ____ ___ ___ ___ ___ ___ ____ ___ ___ ___ ___ ___ _____ ___ ___ ___ ___ ___ ____ ___ ___
/    ____    ____    ____   _____   _      _     ____   __    _   ______   _   __    _   ____                \
|   |    \  |  _ \  |  __| /  _  \ | \    / |   |  __| |  \  | | /  ____| |_| |  \  | | |  __|      <|>      |
|   | |\  | | |_\ | | |__  | |_| | |  \  /  |   | |__  |   \ | | | |  __   _  |   \ | | | |__    /|_/|\_|\   |
|   | | | | |  _ /  |  __| |  _  | |   \/   |   |  __| | |\ \| | | | |_ | | | | |\ \| | |  __|  <<---X--->>  |
|   | |/  | | | |\  | |__  | | | | | |\__/| |   | |__  | | \   | | |___|| | | | | \   | | |__    \| \|/ |/   |
|   |____/  |_| |_\ |____| |_| |_| |_|    |_|   |____| |_|  \__| \______/ |_| |_|  \__| |____|      <|>      |
\___________________________________________________________________________________________________________/

-- by Inateno aka Rogliano Antoine for Dreamirl and all HTML5 lovers --
@DreamirlGames - http://dreamirl.com
@Inateno - http://inateno.com

The Dreamengine is released under the MIT License : http://opensource.org/licenses/MIT
You can't sell the engine, but game made with could be.

The Dreamengine use:
- RequireJS (module loader)                 -->    requirejs.org
- stashJS (localStorage)    by Rezitech     -->    rezitech.github.io/stash
- buzz (audio lib)          by Jay Salvat   -->    buzz.jaysalvat.com
- hand (mouse & touch)      by David Catuhe -->    handjs.codeplex.com

DreamEngine version 0.2.0

*/
/*! Stash v1.2.4 MIT/GPL2 @rezitech */

// Licensed under the MIT license.

// Copyright (C) 2010-2013 Jay Salvat

define("DE.CONFIG",[],function(){var e={};return e.DEName="CONFIG",e.DEBUG=0,e.DEBUG_LEVEL=0,e.CLICK_DELAY=200,e.COLLISION_TYPE={ORIENTED_BOX:1,FIXED_BOX:2,CIRCLE:3},e.DEFAULT_SIZES={BUTTON:{WIDTH:120,HEIGHT:50,OFFSET_TOP:10,FONT_SIZE:25},GUI:{WIDTH:100,HEIGHT:100}},e.debug={log:function(t,n){if(e.DEBUG&&(!n||e.DEBUG_LEVEL>=n)){var r=[];for(var i in arguments)r.push(arguments[i]);r.splice(1,1),console.log.apply(console,r)}}},e.notifications={gamepadEnable:!0,gamepadAvalaible:"Gamepad avalaible !",gamepadChange:!0,achievementUnlockDuration:8e3},e.debug.log("CONFIG loaded",3),e}),define("DE.COLORS",["DE.CONFIG"],function(e){var t={};return t.DEName="COLORS",t.defaultColor="white",t.DEBUG={},t.DEBUG.GAME_OBJECT="white",t.DEBUG.GUI="purple",t.DEBUG.X_AXIS="blue",t.DEBUG.Y_AXIS="red",t.DEBUG.COLLIDER="rgb(205,20,100)",t.DEBUG.CIRCLE_COLLIDER="rgb(205,50,100)",e.debug.log("COLORS loaded",3),t}),define("DE.Event",["DE.CONFIG"],function(e){var t=new function(){this.DEName="Event"};t.callbacks={
},t.contexts={},t.persistents={},t.on=function(e,n,r,i){t.callbacks[e]||(t.callbacks[e]=new Array,t.contexts[e]=new Array,t.persistents[e]=new Array),t.callbacks[e].push(n),t.contexts[e].push(r||window),t.persistents[e].push(i!==undefined?i:!0)},t.trigger=function(){var e=Array.prototype.slice.call(arguments),n=e.shift(),r=t.callbacks[n]||[],i=t.contexts[n]||[],s=t.persistents[n]||[];for(var o=0;o<r.length;o++)r[o].apply(i[o],e),s[o]||(delete r[o],delete i[o],delete s[o],r.splice(o,1),i.splice(o,1),s.splice(o,1),--o)},e.debug.log("Event loaded",3),t.addEventComponents=function(e){e.callbacks={},e.contexts={}},t.addEventCapabilities=function(e){e.prototype?(e.prototype.on=n,e.prototype.trigger=r,e.prototype.stopListen=i):(e.callbacks={},e.contexts={},e.on=n,e.trigger=r,e.stopListen=i)};var n=function(e,t,n){this.callbacks[e]||(this.callbacks[e]=[],this.contexts[e]=[]),this.callbacks[e].push(t),this.contexts[e].push(n||this)},r=function(){var e=Array.prototype.slice.call(arguments),t=e.shift
(),n=this.callbacks[t]||[];for(var r=0;r<n.length;++r)n[r].apply(this.contexts[t][r],e)},i=function(e,t){if(!t)return delete this.callbacks[e],!0;for(var n in this.callbacks[e])if(this.callbacks[e][n]==t)return this.callbacks[e].splice(n,1),this.contexts[e].splice(n,1),!0;return!1};return e.debug.log("Event classes loaded",3),t}),define("DE.Time",["DE.CONFIG","DE.Event"],function(e,t){function s(){document[r]?n.locked=!0:(n.lastCalcul=Date.now(),n.locked=!1)}var n=new function(){this.DEName="Time",this.deltaTime=1,this.missedFrame=0,this.lastCalcul=Date.now(),this.scaleDelta=1,this.currentTime=Date.now(),this.lastRender=Date.now(),this.fps=0,this.FPS=30,this.frameDelay=14,this.update=function(){return this.locked?!1:(this.currentTime=Date.now(),this.timeSinceLastFrame=this.currentTime-this.lastCalcul,this.timeSinceLastFrame<14?!1:(this.fps=Math.floor(1e3/this.timeSinceLastFrame),this.deltaTime=this.timeSinceLastFrame/14*this.scaleDelta,this.missedFrame=this.deltaTime,this.deltaTime>2&&(
this.deltaTime=this.deltaTime%1,this.deltaTime<1&&(this.deltaTime+=1)),this.deltaTime<0&&(this.deltaTime+=1),this.missedFrame=this.missedFrame-this.deltaTime,this.timeSinceLastFrameScaled=(this.currentTime-this.lastRender)*this.scaleDelta,this.lastRender=this.currentTime,this.lastCalcul=this.currentTime,!0))},this.getDelta=function(){return this.deltaTime}};t.on("isInited",function(){n.deltaTime=0,n.lastCalcul=Date.now()});var r,i;return typeof document.hidden!="undefined"?(r="hidden",i="visibilitychange"):typeof document.mozHidden!="undefined"?(r="mozHidden",i="mozvisibilitychange"):typeof document.msHidden!="undefined"?(r="msHidden",i="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(r="webkitHidden",i="webkitvisibilitychange"),typeof document.addEventListener!="undefined"&&typeof r!="undefined"&&document.addEventListener(i,s,!1),e.debug.log("Time loaded",3),n}),define("DE.Vector2",["DE.Time","DE.CONFIG"],function(e,t){function r(t,i,s){this.x=t||0,this.y=i||0,this.z=s||0
,this.rotation=0;var o=1,u=0;return this.setRotation=function(e){return this.rotation=e%(n*2),this.rotation==0?(u=0,o=1):(u=Math.sin(this.rotation),o=Math.cos(this.rotation)),this.rotation},this.setPosition=function(e,t){return e.x!==undefined&&e.y!==undefined?(this.x=e.x,this.y=e.y,this):(this.x=e,this.y=t||0,this)},this.rotate=function(t,n){return n?this.setRotation(this.rotation+t):this.setRotation(this.rotation+t*e.deltaTime)},this.multiply=function(e){return this.x*=e,this.y*=e,this},this.translate=function(t,n,r){if(!t.x&&t.x!=0||!t.y&&t.y!=0)throw new Error(t+" is not a Vector2");return r||(t={x:t.x*e.deltaTime,y:t.y*e.deltaTime}),n?(this.x+=t.x,this.y+=t.y):this.rotation==0?(this.x+=t.x,this.y+=t.y):(this.x-=-t.x*o+t.y*u,this.y-=-t.x*u+t.y*-o),this},this.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);return this.x=this.x/e,this.y=this.y/e,this},this.getVector=function(e,t){if(!e.x&&e.x!=0||!e.y&&e.y!=0||!t.x&&t.x!=0||!t.y&&t.y!=0)throw new Error("Vector2 need two Vector2 to return getVector"
);return this.x=t.x-e.x,this.y=t.y-e.y,this},this.dotProduct=function(e,t){if(!e.x||!e.y)throw new Error("Vector2 need two Vector2 to return dotProduct");return t&&t.x?e.x*t.x+e.y*t.y:this.x*e.x+this.y*e.y},this.getAngle=function(e,t){var n=null;t.x?n=(new r(t.x,t.y)).normalize():n=(new r(this.x,this.y)).normalize();var i=(new r(e.x,e.y)).normalize();return Math.acos(i.dotProduct(n))},this.getDistance=function(e){var t=this.x-e.x;t*=t;var n=this.y-e.y;return n*=n,Math.sqrt(t+n)>>0},this.isInRangeFrom=function(e,t){t*=t;var n=this.x-e.x;n*=n;var r=this.y-e.y;r*=r;var i=n+r;return i<=t?!0:!1},this.getHarmonics=function(e){return e?{cos:Math.cos(e+this.rotation),sin:Math.sin(e+this.rotation)}:{cos:o,sin:u}},this}var n=Math.PI;return r.prototype.DEName="Vector2",t.debug.log("Vector2 loaded",3),r}),define("DE.Sizes",["DE.CONFIG"],function(e){function t(e,t,n,r,i){if(!e||!t)throw new Error("Sizes :: You have to pass a width and height when instantiate -- see the doc");this.width=e,this.height=
t,this.scaleX=n||1,this.scaleY=r||1,this.parent=i,this.setScale=function(e,t){return this._uncenter(),e.x&&e.y?(this.scaleX=e.x,this.scaleY=e.y):t?(this.scaleX=e,this.scaleY=t):(this.scaleX=e,this.scaleY=e),this._center(),this},this._center=function(){return this.parent&&!this.parent.preventCenter&&(this.parent.localPosition.x-=this.width*this.scaleX*.5>>0,this.parent.localPosition.y-=this.height*this.scaleY*.5>>0),this},this._uncenter=function(){return this.parent&&!this.parent.preventCenter&&(this.parent.localPosition.x+=this.width*this.scaleX*.5>>0,this.parent.localPosition.y+=this.height*this.scaleY*.5>>0),this},this.scaleTo=function(e,t){return this._uncenter(),e.x&&e.y?(this.scaleX=e.x,this.scaleY=e.y):(this.scaleX=e,this.scaleY=e),this._center(),this},this.scaleXTo=function(e,t){return this._uncenter(),this.scaleX=valX,this._center(),this},this.scaleYTo=function(e){return this._uncenter(),this.scaleY=valY,this._center(),this},this.setSizes=function(e,t){return this._uncenter(),e.
width?(this.width=e.width,this.height=e.height||this.height):e&&!t?(this.width=e,this.height=e):(this.width=e,this.height=t),this._center(),this}}return t.prototype.DEName="Sizes",e.debug.log("Sizes loaded",3),t}),define("DE.States",["DE.Event","DE.CONFIG"],function(e,t){var n={isLoadingImages:!1,isReady:!1,isInited:!1,isLoading:!0},r=new function(){this.DEName="States",this.up=function(r){t.debug.log("State up "+r,3),i(r,!0),e.trigger(r,!0),n[r]=!0},this.down=function(r){t.debug.log("State down "+r,3),i(r,!1),e.trigger("not"+r,!1),n[r]=!1},this.get=function(e){return n[e]}},i=function(e,t){if(e=="isReady"||e=="isLoading")return;var i=n;(!i.isLoadingImages||e=="isLoadingImages"&&t===!1)&&(i.isInited||e=="isInited"&&t===!0)&&r.up("isReady")};return t.debug.log("states loaded",3),r}),define("DE.CanvasBuffer",["DE.CONFIG"],function(e){function t(e,t){if(!e||!t)throw new Error("CanvasBuffer :: can't instantiate a buffer with a width or a height 0 -- see the doc");this.canvas=document.createElement
("canvas"),this.canvas.width=e,this.canvas.height=t,this.ctx=this.canvas.getContext("2d"),this.ctx.mozImageSmoothingEnabled=!0,this.ctx.webkitImageSmoothingEnabled=!0,this.resize=function(e,t){return this.canvas.width=e,this.canvas.height=t,this},this.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this}}return t.prototype.DEName="CanvasBuffer",e.debug.log("CanvasBuffer loaded",3),t}),define("DE.ImageManager",["DE.CONFIG","DE.States","DE.Event","DE.CanvasBuffer"],function(e,t,n,r){var i=new function(){this.DEName="ImageManager",this.images={},this.imagesLoaded=0,this.imagesRequested=0,this.defaultImages=[],this.pathPrefix="",this.imageNotRatio=!1,this.ratioToConception=1,this.folderName="img",this.arrayLoader=function(n){if(!n){e.debug.log("%cno images loaded",1,"color:red");return}var r=n;for(var i=0,s;i<r.length;++i){s=r[i];if(!s||(s[3]||{}).load===!1)continue;this.pushImage(s[0],s[1],s[2],s[3])}n.length==0&&setTimeout(function(){t.down("isLoadingImages"
)},10)},this.pushImage=function(n,r,s,o){o=o||{},this.images[n]=new Image;var u=this.images[n];u.src=this.folderName+"/"+this.pathPrefix+r+"."+s,u.name=n,u.totalFrame=o.totalFrame||1,u.totalLine=o.totalLine||1,u.eachAnim=o.eachAnim||0,u.isReversed=o.isReversed||!1,u.isAnimated=o.isAnimated||!1,u.isPaused=o.isPaused||!1,u.isLoop=o.isLoop!=undefined?o.isLoop:!0,u.notRatio=o.notRatio||!1,u.totalFrame<=1&&(u.isAnimated=!1),u.onload=function(){i.imageLoaded(this)},this.imagesRequested++,t.up("isLoadingImages"),e.debug.log("LoadImage "+n,3)},this.imageLoaded=function(i){e.debug.log("Image:"+i.name+" correctly loaded",3);var s=new r(i.width,i.height),o=s.canvas,u=s.ctx;if(this.imageNotRatio||i.notRatio)o.width=o.width*this.ratioToConception,o.height=o.height*this.ratioToConception;o.name=i.name,o.totalFrame=i.totalFrame,o.totalLine=i.totalLine,o.eachAnim=i.eachAnim,o.isReversed=i.isReversed,o.isAnimated=i.isAnimated,o.isPaused=i.isPaused,o.isLoop=i.isLoop,o.widthFrame=o.width/o.totalFrame>>0,o
.heightFrame=o.height/o.totalLine>>0,u.drawImage(i,0,0,o.width,o.height),this.images[i.name]=o,this.imagesLoaded++,this.imagesLoaded==this.imagesRequested&&t.down("isLoadingImages"),n.trigger("imageLoaded",this.imagesLoaded,this.imagesRequested,i.name)}};return e.debug.log("ImageManager loaded",3),i}),define("DE.CollisionSystem",["DE.CONFIG"],function(e){var t=new function(){this.DEName="CollisionSystem",this.pointFixedBoxCollision=function(e,t){if(!t.enable)return!1;var n=t.getRealPosition?t.getRealPosition():{x:t.x,y:t.y};return e.x>=n.x&&e.x<n.x+t.width&&e.y>=n.y&&e.y<n.y+t.height?!0:!1},this.fixedBoxCollision=function(e,t){if(!e.enable||!t.enable)return!1;var n=e.getRealPosition?e.getRealPosition():{x:e.x,y:e.y},r=t.getRealPosition?t.getRealPosition():{x:t.x,y:t.y};return r.x>=n.x+e.width||r.x+t.width<=n.x||r.y>=n.y+e.height||r.y+t.height<=n.y?!1:!0},this.pointCircleCollision=function(e,t){if(!t.enable)return!1;var n=t.getRealPosition(),r=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y);return r>
t.radius*t.radius?!1:!0},this.circleCollision=function(e,t){if(!e.enable||!t.enable)return!1;var n=(t.radius+e.radius)*(t.radius+e.radius),r=e.getRealPosition(),i=t.getRealPosition(),s=(i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y);return s<n?!0:!1},this.orientedBoxCollision=function(e,t){if(!e.enable||!t.enable)return!1;var n=e.getExternCircle(),r=t.getExternCircle(),i=n.radius+r.radius;i*=i;var s=e.getRealPosition(),o=t.getRealPosition(),u=(o.x-s.x)*(o.x-s.x)+(o.y-s.y)*(o.y-s.y);return u>i?!1:!0},this.fixedBoxWithOrientedBoxCollision=function(e,t){},this.orientedBoxWithCircleCollision=function(e,t){},this.fixedBoxWithCircleCollision=function(e,t){},this.checkCollisionWith=function(t,n){if(n.type==t.type){switch(t.type){case e.COLLISION_TYPE.FIXED_BOX:return this.fixedBoxCollision(t,n);case e.COLLISION_TYPE.CIRCLES:return this.circleCollision(t,n);case e.COLLISION_TYPE.ORIENTED_BOX:return this.orientedBoxCollision(t,n)}return null}if(!t.type||!n.type){var r=t,i=n;n.type||(r=n,i=t);switch(i.type
){case e.COLLISION_TYPE.CIRCLE:return this.pointCircleCollision(r,i);case e.COLLISION_TYPE.FIXED_BOX:return this.pointFixedBoxCollision(r,i)}return null}return n.type==e.COLLISION_TYPE.ORIENTED_BOX&&t.type==e.COLLISION_TYPE.FIXED_BOX?this.fixedBoxWithOrientedBoxCollision(t,n):n.type==e.COLLISION_TYPE.FIXED_BOX&&t.type==e.COLLISION_TYPE.ORIENTED_BOX?this.fixedBoxWithOrientedBoxCollision(n,t):n.type==e.COLLISION_TYPE.CIRCLE&&t.type==e.COLLISION_TYPE.ORIENTED_BOX?this.orientedBoxWithCircleCollision(t,n):n.type==e.COLLISION_TYPE.ORIENTED_BOX&&t.type==e.COLLISION_TYPE.CIRCLE?this.orientedBoxWithCircleCollision(n,t):n.type==e.COLLISION_TYPE.CIRCLE&&t.type==e.COLLISION_TYPE.FIXED_BOX?this.fixedBoxWithCircleCollision(t,n):n.type==e.COLLISION_TYPE.FIXED_BOX&&t.type==e.COLLISION_TYPE.CIRCLE?this.fixedBoxWithCircleCollision(n,t):null}};return e.debug.log("CollisionSystem loaded",3),t}),define("DE.Collider",["DE.Vector2","DE.CONFIG"],function(e,t){function n(t){t=t||{},this.type=t.type||undefined,this
.enable=!0,this.gameObject=t.gameObject||undefined,this.localPosition=t.localPosition||new e(t.offsetX||t.offsetLeft||0,t.offsetY||t.offsetTop||0),this.isColliding=!1,this.isTrigger=t.isTrigger||!1,this.collideWith=new Array,this.getRealPosition=function(){var e=this.gameObject.getPos(),t=this.gameObject.getHarmonics();return{x:-(-this.localPosition.x*t.cos+this.localPosition.y*t.sin)+e.x,y:-(-this.localPosition.x*t.sin+this.localPosition.y*-t.cos)+e.y}},this.debugRender=function(e,t,n){if(!this.debugBuffer)return;e.drawImage(this.debugBuffer.canvas,this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.debugBuffer.canvas.width*t*n>>0,this.debugBuffer.canvas.height*t*n>>0)}}return n.prototype.DEName="Collider",t.debug.log("Collider loaded",3),n}),define("DE.Renderer",["DE.COLORS","DE.Vector2","DE.CONFIG"],function(e,t,n){function r(n){n=n||{},this.gameObject=n.gameObject||undefined,this.alpha=n.alpha!==undefined?n.alpha:1,this.fillColor=n.fillColor||e.defaultColor,this.strokeColor=
n.strokeColor||e.defaultColor,this.method=n.method||"fill",this.lineWidth=n.lineWidth||1,this.fillColor!=e.defaultColor&&this.strokeColor!=e.defaultColor&&!n.method&&(this.method="fillAndStroke"),this.fillColor==e.defaultColor&&this.strokeColor!=e.defaultColor&&!n.method&&(this.method="stroke"),this.localPosition=n.localPosition||new t(n.offsetx||n.offsetX||n.left||n.x||n.offsetLeft||0,n.offsety||n.offsetY||n.top||n.y||n.offsetTop||0),this.setScale=function(e,t){if(!this.sizes)return;t=t||e,this.sizes.setScale(e,t)},this.scale=function(e,t){if(!this.sizes)return;this.setScale(this.sizes.scaleX+(e||0),this.sizes.scaleY+(t||0))}}return r.prototype={constructor:r,translate:function(e){this.localPosition.translate(e,!0,!0)},translateX:function(e){this.translate({x:e,y:0})},translateY:function(e){this.translate({x:0,y:e})}},r.prototype.render=function(e,t,n){},r.prototype.DEName="Renderer",n.debug.log("Renderer loaded",3),r}),define("DE.GameObject.render",["DE.CONFIG","DE.COLORS","DE.Time"],
function(e,t,n){function r(n,r,i,s,o){if(!this.enable)return;var u=o||10/(this.position.z-i.z),a=0,f=0;if(this.renderers.length==0&&this.childrens.length==0&&!e.DEBUG)return;this.parent?n.translate(this.position.x*r*u>>0,this.position.y*r*u>>0):(a=(this.position.x-(i.x+s.width*.5))*u,f=(this.position.y-(i.y+s.height*.5))*u,n.translate((a+s.width*.5)*r>>0,(f+s.height*.5)*r>>0)),n.rotate(this.position.rotation);for(var l=0,c;c=this.renderers[l];l++)c.render(n,r,u);e.DEBUG_LEVEL>1&&(n.fillStyle=t.DEBUG.GAME_OBJECT,n.fillRect(0,0,1,1),n.fillStyle=t.DEBUG.X_AXIS,n.fillRect(0,0,20*r,2),n.fillStyle=t.DEBUG.Y_AXIS,n.fillRect(0,0,2,20*r),this.collider!==null&&this.collider.debugRender(n,r,u));for(var l=0,h;h=this.childrens[l];l++)h.render(n,r,i,s,u);n.rotate(-this.position.rotation),this.parent?n.translate(-this.position.x*r*u>>0,-this.position.y*r*u>>0):n.translate(-(a+s.width*.5)*r>>0,-(f+s.height*.5)*r>>0)}return e.debug.log("GameObject.render loaded",3),r}),define("DE.GameObject.update",["DE.CollisionSystem"
,"DE.CONFIG","DE.Time"],function(e,t,n){function r(e){if(!this.enable)return;for(var t in this.automatism){var r=this.automatism[t];if(r.interval&&e-r.lastCall<r.interval/n.scaleDelta)continue;r.lastCall=e,this[r.methodName](r.value1,r.value2),r.persistent||delete this.automatism[t]}for(var i=0;child=this.childrens[i];i++)child.update(e);if(!this.isMoved||!this.collider)return}return t.debug.log("GameObject.update loaded",3),r}),define("DE.GameObject",["DE.Vector2","DE.GameObject.render","DE.GameObject.update","DE.CONFIG","DE.Sizes","DE.Event"],function(e,t,n,r,i,s){function u(t){t=t||{},this.id=t.id||Math.random()*999999999>>0,this.name=t.name!=undefined?t.name:"noname",this.tag=t.tag||"none",this.enable=!0,this.scene=null,this.killArgs={},this.sceneIndex=0,this.parent=t.parent||undefined,this.zindex=t.zindex||0,this.cursorOnOver=t.cursorOnOver||!1,this.childrens=t.childrens||new Array,this.position=t.position||new e(t.x||0,t.y||0,t.z||0),this.automatism={},this.flag=null,this.indexMouseOver=
[0,0,0,0,0,0,0,0,0,0,0,0],this.isMoved=!1,this.biggerOffset=new i(1,1,1,1),this.renderers=new Array;if(t.renderers&&t.renderers.length>0)for(var n=0,r;r=t.renderers[n];n++)r.gameObject=this,this.addRenderer(r);t.renderer&&(t.renderer.gameObject=this,this.addRenderer(t.renderer)),this.collider=null,t.collider&&this.setCollider(t.collider),this.rigidbody=t.rigidbody||undefined,this.rigidbody&&this.rigidbody.gameObject!=this&&(this.rigidbody.gameObject=this);if(t.create)for(var n in t.create)this[n]||(this[n]=t.create[n]);s.addEventComponents(this)}var o=Math.PI;return u.prototype={constructor:u},u.prototype.translate=function(e,t){this.moved(),t=t||!1,this.position.translate(e,t)},u.prototype.translateX=function(e,t){t=t||!1,this.translate({x:e,y:0},t)},u.prototype.translateY=function(e,t){t=t||!1,this.translate({x:0,y:e},t)},u.prototype.getPos=function(){if(this.parent){var e=this.parent.getPos(),t=this.parent.getHarmonics();return{x:-(-this.position.x*t.cos+this.position.y*t.sin)+e.x,y:-
(-this.position.x*t.sin+this.position.y*-t.cos)+e.y,z:this.position.z+e.z}}return{x:this.position.x,y:this.position.y,z:this.position.z}},u.prototype.getHarmonics=function(){return this.parent?this.position.getHarmonics(this.parent.getRotation()):this.position.getHarmonics()},u.prototype.getRotation=function(){return this.parent?(this.position.rotation+this.parent.getRotation())%(o*2):this.position.rotation%(o*2)},u.prototype.rotate=function(e){this.moved(),this.position.rotate(e)},u.prototype.lookAt=function(e){this.moved();if(this.parent){var t=this.getPos();this.position.setRotation(-Math.atan2(e.x-t.x,e.y-t.y)-(this.parent.getRotation()-Math.PI));return}this.position.setRotation(-Math.atan2(e.x-this.position.x,e.y-this.position.y)+o)},u.prototype.add=function(){var e=Array.prototype.slice.call(arguments);for(var t=0;t<e.length;++t)if(e[t].length)for(var n=0,r=e[t].length||1;n<r;++n)this.addOne(e[t][n]);else this.addOne(e[t])},u.prototype.addOne=function(e){if(!(e instanceof u))throw new 
Error("DREAM_ENGINE.GameObject.add: this not inherit from GameObject, do it well please");e.parent!==undefined&&e.parent.remove(e),e.parent=this,this.childrens.push(e);if(e.renderers.length>0){var t=e.position.x,n=e.position.y;for(var r=0,i;i=e.renderers[r];r++)i.sizes?(t+i.sizes.width>this.biggerOffset.width?this.biggerOffset.width=t+i.sizes.width:t-i.sizes.width>this.biggerOffset.width&&(this.biggerOffset.width=t-i.sizes.width),n+i.sizes.height>this.biggerOffset.height?this.biggerOffset.height=n+i.sizes.height:n-i.sizes.height>this.biggerOffset.height&&(this.biggerOffset.height=n-i.sizes.height)):i.radius&&(t+i.radius>this.biggerOffset.width?this.biggerOffset.width=t+i.radius:t-i.radius>this.biggerOffset.width&&(this.biggerOffset.width=t-i.radius),n+i.radius>this.biggerOffset.height?this.biggerOffset.height=n+i.radius:n-i.radius>this.biggerOffset.height&&(this.biggerOffset.height=n-i.radius))}},u.prototype.remove=function(e){var t=this.childrens.indexOf(e);t!==-1&&(e.parent=undefined,
this.childrens.splice(t,1))},u.prototype.getChildByName=function(e,t){var n,r;for(n=0;r=this.childrens[n];n++){if(r.name===e)return r;if(t){r=r.getChildByName(e,t);if(r!==undefined)return r}}return undefined},u.prototype.bindGlobalEvent=function(e,t){if(!this.scene){console.log("%cCall bindGlobalEvent without adding the object in a scene","color:red");return}this.scene["on"+(t?"Last":"")+"GlobalMouse"+e][this.id]=this},u.prototype.sortChildrens=function(){this.childrens.sort(function(e,t){return t.position.z==e.position.z?e.zindex-t.zindex:t.position.z-e.position.z})},u.prototype.addRenderer=function(e){return e.gameObject=this,this.renderers.push(e),e.sizes?(e.sizes.width*e.sizes.scaleX+e.localPosition.x>this.biggerOffset.width&&(this.biggerOffset.width=e.sizes.width*e.sizes.scaleX+e.localPosition.x),e.sizes.height*e.sizes.scaleY+e.localPosition.y>this.biggerOffset.height&&(this.biggerOffset.height=e.sizes.height*e.sizes.scaleY+e.localPosition.y)):e.radius&&(e.radius+e.localPosition.x>
this.biggerOffset.width&&(this.biggerOffset.width=e.radius+e.localPosition.x),e.radius+e.localPosition.y>this.biggerOffset.height&&(this.biggerOffset.height=e.radius+e.localPosition.y)),this},u.prototype.setCollider=function(e){return e.gameObject=this,this.collider=e,e.radius?(e.radius>this.biggerOffset.width&&(this.biggerOffset.width=e.radius+e.localPosition.x),e.radius>this.biggerOffset.height&&(this.biggerOffset.height=e.radius+e.localPosition.y)):e.width&&e.height&&(e.width+e.localPosition.x>this.biggerOffset.width&&(this.biggerOffset.width=e.width+e.localPosition.x),e.height+e.localPosition.y>this.biggerOffset.height&&(this.biggerOffset.height=e.height+e.localPosition.y)),this},u.prototype.moved=function(){var e=this;while(e.parent!==undefined)e=e.parent;return e.isMoved=!0,this},u.prototype.delete=function(e){if(this.childrens[e]){this.childrens[e].killMePlease(),delete this.childrens[e],this.childrens.splice(e,1);return}var t=this.childrens.indexOf(e);if(t!==-1){e.killMePlease()
,this.childrens[t]=null,this.childrens.splice(t,1);return}},u.prototype.onMouseDown=undefined,u.prototype.onMouseEnter=undefined,u.prototype.onMouseMove=undefined,u.prototype.onMouseLeave=undefined,u.prototype.onMouseClick=undefined,u.prototype.onMouseUp=undefined,u.prototype.askToKill=function(e){this.scene.cleanObjectBinding(this),this.enable=!1,this.flag="delete",this.killArgs=e||{},!this.killArgs.preventEvents&&!this.killArgs.preventKillEvent&&(this.onKill&&this.onKill(),this.trigger("kill",this))},u.prototype.onKill=undefined,u.prototype.onKilled=undefined,u.prototype.killMePlease=function(){!this.killArgs.preventEvents&&!this.killArgs.preventKilledEvent&&(this.onKilled&&this.onKilled(),this.trigger("killed",this));for(var e=0;e<this.renderers.length;++e)delete this.renderers[e],this.renderers.splice(e,1);delete this.collider;for(e=0;e<this.childrens.length;++e)this.childrens[e].killMePlease(),delete this.childrens[e],this.childrens.splice(e,1)},u.prototype.render=t,u.prototype.update=
n,u.prototype.addAutomatism=function(e,t,n){n=n||{};if(t.type)throw new Error("You use the old way to call addAutomatism, check the doc please");if(!this[t])return r.debug.log("%cCouldn't found the method "+t+" in your GameObject prototype",1,"color:red"),!1;n.interval&&(n.lastCall=Date.now()),n.methodName=t,n.value1=n.value1||undefined,n.value2=n.value2||undefined,n.persistent=n.persistent!=0?!0:!1,this.automatism[e]=n},u.prototype.removeAutomatism=function(e){if(!this.automatism[e]){r.debug.log("%c[RemoveAutomatism] Automatism "+e+" not found",1,"color:orange");return}delete this.automatism[e]},u.prototype.removeAutomatisms=function(){for(var e in this.automatism)delete this.automatism[e]},s.addEventCapabilities(u),u.prototype.DEName="GameObject",r.debug.log("GameObject loaded",3),u}),define("DE.Notifications",[],function(){var e=new function(){this.DEName="Notifications",this.notifs={},this.notifsHeight=0,this.selector="notifsContainer",this.container=null,this.templateName="notificationTemplate"
,this.template=null,this.defaultExpirationTime=3500,this.closeAnimationDuration=400,this.notificationClassName="notification",this.inited=!1;var e=this;this.init=function(e){e=e||{},this.selector=e.selector||this.selector,this.templateName=e.templateName||this.templateName,this.closeAnimationDuration=e.closeAnimationDuration||this.closeAnimationDuration,this.notificationClassName=e.notificationClassName||this.notificationClassName,this.container=e.container||document.getElementById(this.selector);var t=document.getElementById(this.templateName);this.template=e.template||t?t.innerHTML:null;if(!this.container||!this.template)throw new Error("Can't init Notifications without a container element AND a template -- container selector:: "+this.selector+" -- templateName:: "+this.templateName);this.inited=!0,this.notifsHeight=this.container.offsetHeight||0,t&&document.body.removeChild(t)},this.create=function(t,n){if(!this.inited){console.log("You don't init Notifications, init it before call it"
);return}this.notifsHeight=this.notifsHeight<0?0:this.notifsHeight;var r=n||this.defaultExpirationTime,i=Date.now()+"-"+(Math.random()*100>>0),s=document.createElement("div");s.className=this.notificationClassName,s.innerHTML=this.template,s.getElementsByClassName("content")[0].innerHTML=t,s.id="notif"+i,this.container.appendChild(s),this.notifs[i]=s,this.notifs[i].getElementsByClassName("notifClose")[0].addEventListener("click",function(){e.remove(i)});var o=this.notifs[i].offsetHeight;this.notifsHeight+=o,this.container.style.height=this.notifsHeight+"px",this.bindRemove(i,r)},this.bindRemove=function(t,n){n=n||this.defaultExpirationTime,setTimeout(function(){e.triggerRemove(t)},n)},this.triggerRemove=function(t){if(!this.notifs[t])return;this.notifs[t].className=this.notifs[t].className+" disapear",setTimeout(function(){e.remove(t)},this.closeAnimationDuration)},this.remove=function(e){var t=this.notifs[e].offsetHeight;this.notifsHeight-=t,this.container.style.height=this.notifsHeight+"px"
,this.container.removeChild(this.notifs[e]),delete this.notifs[e];return}};return e}),define("DE.LangSystem",["DE.CONFIG"],function(e){var t=new function(){this.DEName="LangSystem",this.currentLang="en",this.dictionary={},this.avalaibleLang=new Array,this.init=function(e){for(var t in e)this.dictionary[t]=e[t],this.avalaibleLang.push(t)},this.get=function(e){return this.dictionary[this.currentLang][e]||this.dictionary.en[e]||null},this.forceGet=function(e,t){return this.avalaibleLang.indexOf(e)==-1?null:this.dictionary[e][t]||null},this.getLang=function(e){this.currentLang=this.avalaibleLang[0],e||(e=navigator.language||navigator.browserLanguage||navigator.userLanguage||"en");for(var t in this.dictionary)if(e.match(t)){this.currentLang=t;break}}};return e.debug.log("LangSystem loaded",3),t}),define("DE.GamePad",["DE.CONFIG","DE.Event","DE.Notifications","DE.LangSystem"],function(e,t,n,r){var i=t.addEventCapabilities,s=function(e){var t=function(){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator
.userAgent)){var e=new Number(RegExp.$1);return e}return!1},n=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("chrome")>-1&&e.indexOf("android")==-1&&e.indexOf("iphone")==-1&&e.indexOf("ipad")==-1&&e.indexOf("ipod")==-1},r={firefox:t,chrome:n};return r[e]()},o={},u=new function(){function d(e){n.create(r.get("onGamepadConnect")||"Gamepad "+(index+1)+" connected"),f[e.gamepad.index]=e.gamepad,f.length++}this.DEName="GamePad";var u={},a={},f={};this.gamePadsInfos={};var l={},c=function(){},h=function(){};this.init=function(){s("chrome")||navigator.getGamepads?(e.notifications.gamepadEnable&&n.create(r.get("gamepadAvalaible")||e.notifications.gamepadAvalaible),c=function(e){var t=navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||[];for(var n=0;n<t.length;++n)if(t[n]){if(!l[n]||l[n]!=t[n].timestamp)l[n]=t[n].timestamp,this.handleGamePad(t[n],e)}else this.disconnectGamePad(n)},h=function(e){var t=navigator.getGamepads&&
navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||[];for(var n=0;n<t.length;++n){var r=t[n];if(r){this.handleGamePad(r,e);continue}this.disconnectGamePad(n)}},this.updateByChange()):s("firefox")};var p=function(e){var t=["leftThumbX","leftThumbY","rightThumbX","rightThumbY"],n=["a","b","y","x","left_shoulder","right_shoulder","LeftTrigger","RightTrigger","back","start","left_thumb","right_thumb","dpad_up","dpad_down","dpad_left","dpad_right"],r={};r.index=e.controllerId,r.timestamp=e.packetNumber,r.buttons=[],r.axes=[];for(var i=0;i<n.length;++i){var s=n[i];if(s=="LeftTrigger"||s=="RightTrigger"){r.buttons[i]=e[s]/255;continue}if(e[s]){r.buttons[i]=1;continue}r.buttons[i]=0}for(var i=0;i<t.length;++i){var s=t[i];r.axes[i]=e[s]/32767;if(s=="leftThumbY"||s=="rightThumbY")r.axes[i]*=-1}return r};this.windowsControllers=[],this.adaptToWindowsLib=function(e,t){var n=t||4;e||console.error("gamepad::adaptToWindowsLib - windowsGamepadLib is null");for(var r=0;
r<n;++r)this.windowsControllers[r]=new e.Controller(r);c=function(e){var t=this.windowsControllers;for(var n=0;n<t.length;++n){var r=t[n];if(r){r=r.getState();if(r.connected){if(!l[n]||l[n]!=r.packetNumber){l[n]=r.packetNumber;var i=p(r);this.handleGamePad(i,e)}continue}this.disconnectGamePad(n)}}},h=function(e){var t=this.windowsControllers;for(var n=0;n<t.length;++n){var r=t[n];if(r){r=r.getState();if(r.connected){var i=p(r);this.handleGamePad(i,e);continue}this.disconnectGamePad(n)}}},this.update=h,this.handleDown=w},window.addEventListener("MozGamepadConnected",d,!1),window.addEventListener("gamepadconnected",d,!1),this.connectToGameLoop=function(e){e.addNonStop("gamePad",this)},this.handleGamePad=function(i,s){var f=i.index;this.gamePadsInfos[f]=i,u[f]&&this.handleListeners(f,i.buttons,u,s),a[f]&&this.handleListeners(f,i.axes,a,s),o[f]||(e.debug.log("Gamepad connected "+f,2),e.notifications.gamepadChange&&(this.isGamepadConnected=!0,n.create(r.get("onGamepadConnect")||"Gamepad "+(f+1
)+" connected")),t.trigger("connectGamepad",f),o[f]=!0)},this.disconnectGamePad=function(i){l[i]=null,f[i]=null,this.gamePadsInfos[i]=null;if(o[i]){e.debug.log("Disconnect gamepad "+i,2);if(e.notifications.gamepadChange){this.isGamepadConnected=!1;for(var s in o)if(o[s]){this.isGamepadConnected=!0;break}n.create(r.get("onGamepadDisconnect")||"Gamepad "+(i+1)+" disconnected")}t.trigger("disconnectGamepad",i),o[i]=!1}};var v=.5,m=function(e){return e<-v&&e<0||e>v&&e>0?!0:!1},g=function(e,t,n,r){m(r)&&!n.active&&(t.trigger("down"+e,r,e),n.active=!0)},y=500,b=150,w=function(e,t,n,r,i){if(m(r)){if(!n.active)return t.trigger("down"+e,r,e),n.active=!0,n.timesTamp=i,n.diffTime=y,!0;if(n.noRate)return!0;if(n.timesTamp+n.diffTime<i)return t.trigger("down"+e,r,e),n.timesTamp=i,n.diffTime=b,!0}return!1},E=function(e,t,n,r){for(var i in n[e].listeners){var s=s=t[i].value!==undefined?t[i].value:t[i],o=n[e],u=n[e].listeners[i];if(s<.3&&s>0||s>-0.3&&s<0)s=0;s!=u.force&&o.trigger("move"+i,s,i),u.force=s
;if(this.handleDown(i,o,u,s,r))continue;!m(s)&&u.active&&(o.trigger("up"+i,s,i),u.active=!1,u.count=0)}};this.handleListeners=E,this.handleGamePadAxes=function(e){for(var t in a[e.index].listeners)if(e.axes[t]>0&&!a[e.index].listeners[t]){u[e.index].trigger("down"+t),u[e.index].listeners[t]=!0;continue}};var S=function(e,t,n){e[t]||(e[t]={},e[t].listeners={},i(e[t])),typeof e[t].listeners[n]=="undefined"&&(e[t].listeners[n]={active:!0,force:0})},x=function(e,t,n,r,i,s){S(e,t,n),e[t].on(r+n,i),e[t].listeners[n].noRate=s},T=function(e,t,n,r){e[t]&&e[t].del(r+n)},N=function(e,t,n){if(!e[t])return;T(e,t,n,"down"),T(e,t,n,"up"),T(e,t,n,"move"),delete e[t].listeners[n]},C=function(e,t){if(!e[t])return;for(var n in e[t].listeners)N(e,t,n)},k=function(e){if(!e)return;for(var t in e)C(e,t)};this.onBtnDown=function(e,t,n,r){x(u,e,t,"down",n,r)},this.onBtnMove=function(e,t,n,r){x(u,e,t,"move",n,r)},this.onBtnUp=function(e,t,n,r){x(u,e,t,"up",n,r)},this.delBtnDown=function(e,t){T(u,e,t,"down")},this
.delBtnMove=function(e,t){T(u,e,t,"move")},this.delBtnUp=function(e,t){T(u,e,t,"up")},this.delBtn=function(e,t){N(u,e,t)},this.delBtnsPad=function(e){C(u,e)},this.delBtnsListeners=function(){k(u)},this.onAxeStart=function(e,t,n,r){x(a,e,t,"down",n,r)},this.onAxeMove=function(e,t,n,r){x(a,e,t,"move",n,r)},this.onAxeStop=function(e,t,n,r){x(a,e,t,"up",n,r)},this.delAxeStart=function(e,t){T(a,e,t,"down")},this.delAxeMove=function(e,t){T(a,e,t,"move")},this.delAxeStop=function(e,t){T(a,e,t,"up")},this.delAxe=function(e,t){N(a,e,t)},this.delAxesPad=function(e){C(a,e)},this.delAxesListeners=function(){k(a)},this.delListeners=function(){k(a),k(u)},this.plugBtnToInput=function(e,t,n,r){this.onBtnDown(n,r,function(n){e.usedInputs[t].isDown=!0,e.trigger("keyDown",t,n)},!1),this.onBtnUp(n,r,function(n){e.usedInputs[t].isDown=!1,e.trigger("keyUp",t,n)},!1),this.onBtnMove(n,r,function(n){e.trigger("btnMoved",t,n)},!1)},this.plugAxeToInput=function(e,t,n,r){this.onAxeStart(n,r,function(n){e.trigger("axeStart"
,t,n)},!1),this.onAxeStop(n,r,function(n){e.trigger("axeStop",t,n)},!1),this.onAxeMove(n,r,function(n){e.trigger("axeMoved",t,n)},!1)},this.updateByRate=function(){this.update=h,this.handleDown=w},this.updateByChange=function(){this.update=c,this.handleDown=g},this.update=function(){}};return e.debug.log("gamepad loaded",3),u}),define("handjs",[],function(){function S(){w=!0,clearTimeout(E),E=setTimeout(function(){w=!1},700)}function x(e){var t=[];if(e){t.unshift(e);while(e.parentNode)t.unshift(e.parentNode),e=e.parentNode}return t}function T(e,t){var n=x(e),r=x(t),i=null;while(n.length>0&&n[0]==r.shift())i=n.shift();return i}function N(e,t,n){var r=T(e,t),i=e,s=[];while(i&&i!=r)c(i,"pointerenter")&&s.push(i),i=i.parentNode;while(s.length>0)n(s.pop())}function C(e,t,n){var r=T(e,t),i=e;while(i&&i!=r)c(i,"pointerleave")&&n(i),i=i.parentNode}function k(e,t){["pointerdown","pointermove","pointerup","pointerover","pointerout"].forEach(function(n){window.addEventListener(e(n),function(e){!w&&
h(e.target,n)&&t(e,n,!0)})}),window["on"+e("pointerenter").toLowerCase()]===undefined&&window.addEventListener(e("pointerover"),function(e){if(w)return;var n=h(e.target,"pointerenter");if(!n||n===window)return;n.contains(e.relatedTarget)||N(n,e.relatedTarget,function(n){t(e,"pointerenter",!1,n,e.relatedTarget)})}),window["on"+e("pointerleave").toLowerCase()]===undefined&&window.addEventListener(e("pointerout"),function(e){if(w)return;var n=h(e.target,"pointerleave");if(!n||n===window)return;n.contains(e.relatedTarget)||C(n,e.relatedTarget,function(n){t(e,"pointerleave",!1,n,e.relatedTarget)})})}var e=e||{};if(window.PointerEvent)return;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array
.prototype.forEach||(Array.prototype.forEach=function(e,t){if(!this||!(e instanceof Function))throw new TypeError;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/,"")});var t=["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","pointerenter","pointerleave"],n=["PointerDown","PointerUp","PointerMove","PointerOver","PointerOut","PointerCancel","PointerEnter","PointerLeave"],r="touch",i="pen",s="mouse",o={},u=function(e){while(e&&!e.handjs_forcePreventDefault)e=e.parentNode;return!!e||window.handjs_forcePreventDefault},a=function(e,t,n,o,u){var a;document.createEvent?(a=document.createEvent("MouseEvents"),a.initMouseEvent(t,n,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,u||e.relatedTarget)):(a=document.createEventObject(),a.screenX=e.screenX,a.screenY=e.screenY,a.clientX=e.clientX,a.clientY=e.clientY,a.ctrlKey=
e.ctrlKey,a.altKey=e.altKey,a.shiftKey=e.shiftKey,a.metaKey=e.metaKey,a.button=e.button,a.relatedTarget=u||e.relatedTarget),a.offsetX===undefined&&(e.offsetX!==undefined?(Object&&Object.defineProperty!==undefined&&(Object.defineProperty(a,"offsetX",{writable:!0}),Object.defineProperty(a,"offsetY",{writable:!0})),a.offsetX=e.offsetX,a.offsetY=e.offsetY):Object&&Object.defineProperty!==undefined?(Object.defineProperty(a,"offsetX",{get:function(){return this.currentTarget&&this.currentTarget.offsetLeft?e.clientX-this.currentTarget.offsetLeft:e.clientX}}),Object.defineProperty(a,"offsetY",{get:function(){return this.currentTarget&&this.currentTarget.offsetTop?e.clientY-this.currentTarget.offsetTop:e.clientY}})):e.layerX!==undefined&&(a.offsetX=e.layerX-e.currentTarget.offsetLeft,a.offsetY=e.layerY-e.currentTarget.offsetTop)),e.isPrimary!==undefined?a.isPrimary=e.isPrimary:a.isPrimary=!0;if(e.pressure)a.pressure=e.pressure;else{var f=0;e.which!==undefined?f=e.which:e.button!==undefined&&(f=e
.button),a.pressure=f==0?0:.5}e.rotation?a.rotation=e.rotation:a.rotation=0,e.hwTimestamp?a.hwTimestamp=e.hwTimestamp:a.hwTimestamp=0,e.tiltX?a.tiltX=e.tiltX:a.tiltX=0,e.tiltY?a.tiltY=e.tiltY:a.tiltY=0,e.height?a.height=e.height:a.height=0,e.width?a.width=e.width:a.width=0,a.preventDefault=function(){e.preventDefault!==undefined&&e.preventDefault()};if(a.stopPropagation!==undefined){var l=a.stopPropagation;a.stopPropagation=function(){e.stopPropagation!==undefined&&e.stopPropagation(),l.call(this)}}a.pointerId=e.pointerId,a.pointerType=e.pointerType;switch(a.pointerType){case 2:a.pointerType=r;break;case 3:a.pointerType=i;break;case 4:a.pointerType=s}o?o.dispatchEvent(a):e.target?e.target.dispatchEvent(a):e.srcElement.fireEvent("on"+d(t),a)},f=function(e,t,n,r,i){e.pointerId=1,e.pointerType=s,a(e,t,n,r,i)},l=function(e,t,n,i,s,o){var u=t.identifier+2;t.pointerId=u,t.pointerType=r,t.currentTarget=n,i.preventDefault!==undefined&&(t.preventDefault=function(){i.preventDefault()}),a(t,e,s,n,
o)},c=function(e,t){return e.__handjsGlobalRegisteredEvents&&e.__handjsGlobalRegisteredEvents[t]},h=function(e,t){while(e&&!c(e,t))e=e.parentNode;if(e)return e;if(c(window,t))return window},p=function(e,t,n,r,i,s){h(n,e)&&l(e,t,n,r,i,s)},d=function(e){return e.toLowerCase().replace("pointer","mouse")},v=function(e,r){var i=t.indexOf(r),s=e+n[i];return s},m=function(e,t,n,r){e.__handjsRegisteredEvents===undefined&&(e.__handjsRegisteredEvents=[]);if(r){if(e.__handjsRegisteredEvents[t]!==undefined){e.__handjsRegisteredEvents[t]++;return}e.__handjsRegisteredEvents[t]=1,e.addEventListener(t,n,!1)}else{if(e.__handjsRegisteredEvents.indexOf(t)!==-1){e.__handjsRegisteredEvents[t]--;if(e.__handjsRegisteredEvents[t]!=0)return}e.removeEventListener(t,n),e.__handjsRegisteredEvents[t]=0}},g=function(e,t,n){e.__handjsGlobalRegisteredEvents||(e.__handjsGlobalRegisteredEvents=[]);if(n){if(e.__handjsGlobalRegisteredEvents[t]!==undefined){e.__handjsGlobalRegisteredEvents[t]++;return}e.__handjsGlobalRegisteredEvents
[t]=1}else e.__handjsGlobalRegisteredEvents[t]!==undefined&&(e.__handjsGlobalRegisteredEvents[t]--,e.__handjsGlobalRegisteredEvents[t]<0&&(e.__handjsGlobalRegisteredEvents[t]=0));var r,i;window.MSPointerEvent?(r=function(e){return v("MS",e)},i=a):(r=d,i=f);switch(t){case"pointerenter":case"pointerleave":var s=r(t);e["on"+s.toLowerCase()]!==undefined&&m(e,s,function(e){i(e,t)},n)}},y=function(e){var n=e.prototype?e.prototype.addEventListener:e.addEventListener,r=function(e,r,i){t.indexOf(e)!=-1&&g(this,e,!0),n===undefined?this.attachEvent("on"+d(e),r):n.call(this,e,r,i)};e.prototype?e.prototype.addEventListener=r:e.addEventListener=r},b=function(e){var n=e.prototype?e.prototype.removeEventListener:e.removeEventListener,r=function(e,r,i){t.indexOf(e)!=-1&&g(this,e,!1),n===undefined?this.detachEvent(d(e),r):n.call(this,e,r,i)};e.prototype?e.prototype.removeEventListener=r:e.removeEventListener=r};y(window),y(window.HTMLElement||window.Element),y(document),y(HTMLBodyElement),y(HTMLDivElement
),y(HTMLImageElement),y(HTMLUListElement),y(HTMLAnchorElement),y(HTMLLIElement),y(HTMLTableElement),window.HTMLSpanElement&&y(HTMLSpanElement),window.HTMLCanvasElement&&y(HTMLCanvasElement),window.SVGElement&&y(SVGElement),b(window),b(window.HTMLElement||window.Element),b(document),b(HTMLBodyElement),b(HTMLDivElement),b(HTMLImageElement),b(HTMLUListElement),b(HTMLAnchorElement),b(HTMLLIElement),b(HTMLTableElement),window.HTMLSpanElement&&b(HTMLSpanElement),window.HTMLCanvasElement&&b(HTMLCanvasElement),window.SVGElement&&b(SVGElement);var w=!1,E=-1;return function(){window.MSPointerEvent?k(function(e){return v("MS",e)},a):(k(d,f),window.ontouchstart!==undefined&&(window.addEventListener("touchstart",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t];o[n.identifier]=n.target,p("pointerover",n,n.target,e,!0),N(n.target,null,function(t){l("pointerenter",n,t,e,!1)}),p("pointerdown",n,n.target,e,!0)}S()}),window.addEventListener("touchend",function(e){for(var t=0
;t<e.changedTouches.length;++t){var n=e.changedTouches[t],r=o[n.identifier];p("pointerup",n,r,e,!0),p("pointerout",n,r,e,!0),C(r,null,function(t){l("pointerleave",n,t,e,!1)})}S()}),window.addEventListener("touchmove",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t],r=document.elementFromPoint(n.clientX,n.clientY),i=o[n.identifier];i&&u(i)===!0&&e.preventDefault(),p("pointermove",n,i,e,!0);if(i===r)continue;i&&(p("pointerout",n,i,e,!0,r),i.contains(r)||C(i,r,function(t){l("pointerleave",n,t,e,!1,r)})),r&&(p("pointerover",n,r,e,!0,i),r.contains(i)||N(r,i,function(t){l("pointerenter",n,t,e,!1,i)})),o[n.identifier]=r}S()}),window.addEventListener("touchcancel",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t];p("pointercancel",n,o[n.identifier],e,!0)}})))}(),navigator.pointerEnabled===undefined&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&(navigator.maxTouchPoints=navigator.msMaxTouchPoints)),document.styleSheets&&document
.addEventListener&&document.addEventListener("DOMContentLoaded",function(){if(e.doNotProcessCSS||document.body.style.touchAction!==undefined)return;var t=new RegExp(".+?{.*?}","m"),n=new RegExp(".+?{","m"),r=function(e){var r=t.exec(e);if(!r)return;var i=r[0];e=e.replace(i,"").trim();var s=n.exec(i)[0].replace("{","").trim();if(i.replace(/\s/g,"").indexOf("touch-action:none")!=-1){var o=document.querySelectorAll(s);for(var u=0;u<o.length;u++){var a=o[u];a.style.msTouchAction!==undefined?a.style.msTouchAction="none":a.handjs_forcePreventDefault=!0}}return e},i=function(e){if(window.setImmediate)e&&setImmediate(i,r(e));else while(e)e=r(e)};try{for(var s=0;s<document.styleSheets.length;s++){var o=document.styleSheets[s];if(o.href==undefined)continue;var u=new XMLHttpRequest;u.open("get",o.href),u.send();var a=u.responseText.replace(/(\n|\r)/g,"");i(a)}}catch(f){}var l=document.getElementsByTagName("style");for(var s=0;s<l.length;s++){var c=l[s],h=c.innerHTML.replace(/(\n|\r)/g,"").trim();i
(h)}},!1),""}),define("DE.Inputs",["DE.CONFIG","DE.Event","DE.GamePad","handjs"],function(e,t,n){var r=new function(){function s(e){return e.pointerId=e.pointerId||0,r.mouse[e.pointerId]||(r.mouse[e.pointerId]={isDown:!1,x:0,y:0,index:e.pointerId}),r.mouse[e.pointerId].isDown=!0,r.mouse[e.pointerId].x=e.clientX,r.mouse[e.pointerId].y=e.clientY,r.mouse[e.pointerId]}this.DEName="Inputs",this.isListening=!1,this.usedInputs={};var i={};this.keyLocked=!1,this.mouse=[{x:0,y:0,isDown:!1,index:0}],this.dbInputs={MOUSE:{leftClick:1000000001,rightClick:1000000002,wheelTop:1000000003,wheelDown:1000000004},KEYBOARD:{up:38,down:40,left:37,right:39,space:32,shift:16,caps:20,tab:9,escape:27,d:68,q:81,z:90,s:83,a:65,e:69,r:82,t:84,y:89,u:85,i:73,o:79,p:80,f:70,g:71,h:72,j:74,k:75,l:76,m:77,w:87,x:88,c:67,v:86,b:66,n:78,enter:13,"return":8,"PAD+":107,"PAD-":109,"PAD*":106,"PAD/":111,PAD0:96,PAD1:97,PAD2:98,PAD3:99,PAD4:100,PAD5:101,PAD6:102,PAD7:103,PAD8:104,PAD9:105,F5:116,F11:122,F12:123},GAMEPADBUTTONS
:{A:0,B:1,Y:3,X:2,"D-Up":12,"D-Right":15,"D-Left":14,"D-Bot":13,select:8,start:9,RBS:7,RTS:5,LBS:6,LTS:4,power:16},GAMEPADAXES:{LHorizontal:0,LVertical:1,RHorizontal:2,RVertical:3}},this.debugKeys=[123],this.ignoreKeys=[116,122,123],this.queue={keyDown:{},keyUp:{},mouseDown:{},mouseUp:{},btnMoved:{},axeMoved:{},axeStart:{},axeStop:{}},this.on=function(e,t,n){if(!this.queue[e][t]){console.log("%cWARN:: Try to bind on a non existant input ::: "+e+" - "+t,"color:red");return}this.queue[e][t].push(n)},this.init=function(e){var t={};for(var r in e){t[r]={},t[r].inputs=new Array;for(var i=0,s;s=e[r].keycodes[i];i++){var o=s[0]=="K"||s[0]=="k"?"KEYBOARD":"MOUSE",u=s.split("."),a=0,f;u[0][0]=="G"?(u[0][1]&&(a=parseInt(u[0][1])),u[1]=="A"?o="GAMEPADAXES":o="GAMEPADBUTTONS",f=u[2]):f=s.slice(2,s.length);if(typeof this.dbInputs[o][f]=="undefined"){console.log("%cAn input couldn't be found in the database, did you respect the caseSensitive ?:"+o+"."+f+"\n Ignoring it and continue...","color:red");continue}
o=="GAMEPADBUTTONS"?n.plugBtnToInput(this,r,a,this.dbInputs[o][f]):o=="GAMEPADAXES"&&n.plugAxeToInput(this,r,a,this.dbInputs[o][f]),t[r].inputs.push({code:this.dbInputs[o][f],type:o})}t[r].interval=e[r].interval||0,t[r].lastCall=Date.now(),t[r].actions={},t[r].isDown=!1,t[r].isLongPress=e[r].isLongPress||!1,t[r].stayOn=e[r].stayOn||!1,t[r].numberCall=0,t[r].numberPress=0,t[r].stayOn&&(t[r].lastCall=Date.now()+t[r].interval),this.queue.keyDown[r]=new Array,this.queue.keyUp[r]=new Array,this.queue.mouseDown[r]=new Array,this.queue.mouseUp[r]=new Array,this.queue.btnMoved[r]=new Array,this.queue.axeMoved[r]=new Array,this.queue.axeStart[r]=new Array,this.queue.axeStop[r]=new Array}this.usedInputs=t,this.toggleListeners()},this.get=function(e){return this.usedInputs[e]?this.usedInputs[e]:!1},this.trigger=function(e,t,n){if(r.keyLocked&&e.search("mouse")==-1)return;for(var i in r.queue[e][t])r.queue[e][t][i](n)},this.key=function(e){if(r.keyLocked)return;return this.usedInputs[e]&&this.usedInputs
[e].isDown&&(!this.usedInputs[e].interval||Date.now()-this.usedInputs[e].lastCall>=this.usedInputs[e].interval)?(r.usedInputs[e].stayOn||(r.usedInputs[e].lastCall=Date.now()),r.usedInputs[e].numberCall++,!0):!1},this.toggleListeners=function(e,t){var n=e||window;this.isListening&&!t?n.removeEventListener?(n.removeEventListener("keydown",r.keyDown,!1),n.removeEventListener("keyup",r.keyUp,!1),n.removeEventListener("keypress",r.keyPress,!1)):n.detachEvent&&(n.detachEvent("onkeydown",r.keyDown),n.detachEvent("onkeyup",r.keyUp),n.detachEvent("onkeypress",r.keyPress)):n.addEventListener?(n.addEventListener("keydown",r.keyDown,!1),n.addEventListener("keyup",r.keyUp,!1),n.addEventListener("keypress",r.keyPress,!1)):n.attachEvent&&(n.attachEvent("onkeydown",r.keyDown),n.attachEvent("onkeyup",r.keyUp),n.attachEvent("onkeypress",r.keyPress))},this.findInput=function(e,t){for(var n in r.usedInputs)for(var i in r.usedInputs[n].inputs){var s=r.usedInputs[n].inputs[i].code,o=r.usedInputs[n].inputs[i]
.type;if(s==e&&o==t)return n}return!1},this.keyDown=function(n){var i=n||window.event,s=i.which||i.keyCode;if(r.ignoreKeys.indexOf(s)!=-1){if(r.debugKeys.indexOf(s)!=-1){if(e.DEBUG)return;i.preventDefault()}return}s==r.dbInputs.KEYBOARD.shift?r.isShiftDown=!0:r.isShiftDown&&s==r.dbInputs.KEYBOARD.tab&&t.trigger("toggle-nebula");if(r.keyLocked)return s==r.dbInputs.KEYBOARD.escape&&t.trigger("close-nebula"),!1;var o=r.findInput(s,"KEYBOARD");o!==!1&&(!r.usedInputs[o].isDown&&Date.now()-r.usedInputs[o].lastCall>=r.usedInputs[o].interval&&(r.usedInputs[o].isLongPress&&!r.usedInputs[o].stayOn&&(r.usedInputs[o].lastCall=Date.now()),r.usedInputs[o].isDown||r.trigger("keyDown",o,1),r.usedInputs[o].isDown=!0),r.usedInputs[o].numberPress++),i.preventDefault()},this.keyUp=function(e){var t=e||window.event,n=t.which||t.keyCode;n==r.dbInputs.KEYBOARD.shift&&(r.isShiftDown=!1);if(r.keyLocked)return!1;var i=r.findInput(n,"KEYBOARD");i!==!1&&(r.usedInputs[i].isDown&&r.trigger("keyUp",i),r.usedInputs[i]
.stayOn&&(r.usedInputs[i].lastCall=Date.now()),r.usedInputs[i].isDown=!1)},this.keyPress=function(e){var t=e||window.event,n=t.which||t.keyCode,i=t.keyCode,s=r.findInput(i,"KEYBOARD");s!==!1&&r.usedInputs[s].isDown},this.mouseDown=function(e){i[e.target.id]&&i[e.target.id].oOnMouseDown(s(e));var t=r.findInput(1000000001,"MOUSE");return t!==!1&&(r.usedInputs[t].isDown||r.trigger("mouseDown",t),r.usedInputs[t].isDown=!0),!1},this.mouseUp=function(e){i[e.target.id]&&i[e.target.id].oOnMouseUp(s(e));var t=r.findInput(1000000001,"MOUSE");return t!==!1&&(r.usedInputs[t].isDown&&r.trigger("mouseUp",t),r.usedInputs[t].isDown=!1),e.preventDefault(),!1},this.mouseMove=function(e){return i[e.target.id]&&i[e.target.id].oOnMouseMove(s(e)),e.preventDefault(),!1},this.mouseClick=function(e){},this.mouseDbClick=function(){},this.rightClick=function(e){e.preventDefault(),e.stopPropagation()},this.addEvent=function(e){},this.addActionInput=function(t,n,r){if(!this.checkInputExist(n))return;e.DEBUG&&e.DEBUG_LEVEL>=3&&
this.usedInputs[n].actions[r]&&e.debug.log("Replace the action "+r+" on input "+n,3)},this.removeActionInput=function(t,n){if(!this.checkInputExist(t))return;if(!this.usedInputs[t].actions[n])throw new Error("Try to remove a not founded action by id:: "+n);e.debug.log("Remove the action "+n+" on input "+t,3),delete this.usedInputs[t].actions[n]},this.checkInputExist=function(t){return this.usedInputs[t]?!0:(e.debug.log("Try to access an input not defined:: "+t,1),!1)},this.addRender=function(e){i[e.id]=e;var t=e.canvas;t.addEventListener("pointerdown",r.mouseDown,!1),t.addEventListener("pointerup",r.mouseUp,!1),t.addEventListener("pointerout",r.mouseMove,!1),t.addEventListener("pointermove",r.mouseMove,!1),t.addEventListener("contextmenu",r.rightClick,!1),t.addEventListener("DOMMouseScroll",r.mouseWheel,!1),t.addEventListener("mousewheel",r.mouseWheel,!1),t.onmousewheel=r.mouseWheel,window.attachEvent&&t.attachEvent("onmousewheel",r.mouseWheel)},this.removeRender=function(t){if(!i[t].canvas
){e.debug.log("[INPUTS] Try to remove a renders but not found :: "+t,1);return}i[t].canvas.removeEventListener("pointerdown",r.mouseDown,!1),i[t].canvas.removeEventListener("pointerup",r.mouseUp,!1),i[t].canvas.removeEventListener("pointerout",r.mouseUp,!1),i[t].canvas.removeEventListener("pointermove",r.mouseMove,!1),i[t].canvas.removeEventListener("contextmenu",r.rightClick,!1),i[t].canvas.removeEventListener("DOMMouseScroll",r.mouseWheel,!1),delete i[t]},this.mouseWheel=function(e){var t=e.wheelDelta>0?1:-1;e.detail&&(t=e.detail<0?1:-1),t==1?r.trigger("axeMoved","wheelTop"):r.trigger("axeMoved","wheelDown")}};return window.onbeforeunload=function(e){if(!window.leavePage)return"En quittant la page vous allez perdre toute progression non sauvegard\u00e9."},window.onunload=function(e){t.trigger("unload-game")},e.debug.log("Inputs loaded",3),r}),define("DE.SystemDetection",["DE.CONFIG","DE.LangSystem"],function(e,t){var n=new function(){this.DEName="SystemDetection",this.touchPlatform=!1
,this.init=function(e){ua=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(ua)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i
.test(ua.substr(0,4)))this.touchPlatform=!0;if(e.touchPlatform||window.ENGINE_SETTING&&window.ENGINE_SETTING.touchPlatform)this.touchPlatform=!0;t.getLang()},this.render=null,this.scene=null,this.camera=null,this.isOverridingMainLoop=!1,this.askToRateIf="playedOnce",this.askToRate=function(){},this.initSystem=function(e,t){if(e)for(var n in e)this[n]=e[n];this.init(t)}};return e.debug.log("SystemDetection loaded",3),n}),define("stash",[],function(){function r(e,t){return t!==undefined&&t!==null&&t.constructor===e}function i(e){return"'"+String(e).replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")+"'"}function s(e){var t=n.createElement("_");return t.innerHTML=e,t.firstChild}function o(e){if(e.outerHTML)return e.outerHTML;var t=n.createElement("_");return t.appendChild(e.cloneNode(!0)),t.innerHTML}function u(t){var s=arguments.callee,u=[],a,f=-1,l;if(r(String,t))return i(t);if(t===undefined||t===null||r(Boolean,t)||r(Number,t)||r(RegExp
,t)||r(Function,t)&&!/^function[^\{]+\{\s*\[native code\]/.test(String(t)))return String(t);if(r(Date,t))return"new Date("+t.getTime()+")";if(r(Array,t)){a=t.length;while(++f<a)u.push(s(t[f]));return"["+u+"]"}if(r(Object,t)){for(l in t)u.push(i(l)+":"+s(t[l]));return"{"+u+"}"}if(t===e)return"window";for(l in e)if(t===e[l])return"window."+l;for(l in n)if(t===n[l])return"document."+l;if(t.nodeName)return"h("+i(o(t))+")"}function a(t){return(new Function("var a=arguments;h=a[0];return "+t)).apply(e,[s])}function f(){var e={},t=arguments,n=t.length,i=-1,s;while(++i<n)if(r(Object,t[i]))for(s in t[i])e[s]=r(Object,e[s])&&r(Object,t[i][s])?t.callee(e[s],t[i][s]):t[i][s];return e}function l(e,n,i){var s=t[e],o;if(i){o=a(s);if(r(Array,o))n=o.concat(n);else if(r(Boolean,o))n=o&&!!n;else if(r(Date,o)&&!isNaN(n*1))n=new Date(o.getTime()+n*1);else if(r(Function,o)&&r(Function,n))n=new Function("return("+String(o)+").apply(this, arguments)&&("+String(n)+").apply(this, arguments)");else if(r(Number,o)&&!
isNaN(n*1))n=o+n*1;else if(r(Object,o)&&r(Object,n))n=f(o,n);else if(r(RegExp,o)&&r(RegExp,n)){var l=/^\/([\W\w]*)\/([a-z]*?)$/,c=String(o).match(l),h=String(n).match(l);n=new RegExp(c[1]+h[1],c[2]+h[2])}else{if(!r(String,o))return 2;n=o+String(n)}}return n=u(n),s===n?2:(t[e]=n)&&1}var e=window,t=window.document.localStorage||window.localStorage,n=document,c={has:function(){var e=[].concat.apply([],arguments),n,r=-1;while(n=e[++r])if(t[n]===undefined)return!1;return!0},get:function(e){var n=[].concat.apply([],arguments),r,i=-1,s={};if(n.length===1)return a(t[e]);while(r=n[++i])s[r]=a(t[r]);return s},getAll:function(){var e,n={};for(e in t)n[e]=t[e];return n},set:function(e,t){var n=[].concat.apply([],arguments),i,s=-1,o,u=2;if(r(String,e))return l(e,t);while(i=n[++s])for(o in i)u=Math.min(u,l(o,i[o]));return u},add:function(e,t){var n=[].concat.apply([],arguments),i,s=-1,o,u=2;if(r(String,e))return l(e,t,!0);while(i=n[++s])for(o in i)u=Math.min(u,l(o,i[o],!0));return u},cut:function(e){
var n=[].concat.apply([],arguments),r,i=-1;while(r=n[++i])delete t[r];return!0},cutAll:function(){for(var e in t)delete t[e];return!0}};return c}),define("DE.about",["DE.CONFIG"],function(e){var t={};return t.DEName="about",t.version="0.1.0",t.gameName="DreamGame",t.gameVersion="0.1.0",t.gameAuthor="Dreamirl",t.set=function(e){e=e||{},t.gameName=e.gameName||t.gameName,t.gameVersion=e.gameVersion||t.gameVersion,t.gameAuthor=e.gameAuthor||t.gameAuthor,t.namespace=e.namespace||null},e.debug.log("about loaded",3),t}),define("DE.SaveSystem",["stash","DE.CONFIG","DE.about","DE.Event"],function(e,t,n,r){var i=new function(){this.DEName="SaveSystem",this.saveModel={},this.namespace="DreamGame",this.useLocalStorage=!0,this.init=function(t,r){t=t||{},t.settings||(t.settings={}),this.namespace=n.namespace,this.version=n.version,r&&(this.version=e.get(this.namespace)),this.saveModel=t;for(var i in this.saveModel)this.saveModel[i]=e.get(this.namespace+this.version+i)||this.saveModel[i];this.loadSave
(this.saveModel,!0)},this.updateSave=function(){if(!this.useLocalStorage)return;for(var t in this.saveModel)e.cut(this.namespace+this.version+t);this.version=n.version,e.set(this.namespace,this.version);for(var t in this.saveModel)e.set(this.namespace+this.version+t,this.saveModel[t])},this.loadSave=function(e,t){this.useLocalStorage=t;for(var n in e)!this.saveModel[n]&&this.saveModel[n]!==!1&&this.saveModel[n]!==0&&(r.trigger("savesystem-attr-not-found",n),console.log("Seems your game version is to old, we send a report",n)),this.saveModel[n]=e[n];this.updateSave(),r.trigger("savesystem-loaded",this.saveModel)},this.get=function(t){return t in this.saveModel||(this.saveModel[t]=e.get(this.namespace+this.version+t)||this.saveModel[t]),this.saveModel[t]},this.save=function(n,i){n in this.saveModel||t.debug.log("%c[WARN] You save a key doesn't exist in your saveModel ! add it to your saveModel but engine wont be able to get it later",0,"color:orange"),i||(i=this.get(n)),this.useLocalStorage&&
e.set(this.namespace+this.version+n,i),this.saveModel[n]=i,r.trigger("savesystem-save",this.saveModel)},this.saveAll=function(){if(!this.useLocalStorage)return;for(var t in this.saveModel)e.set(this.namespace+this.version+t,this.saveModel[t])},this.saveAchievements=function(t){if(!this.useLocalStorage)return;e.set(this.namespace+"achievements",t)},this.loadAchievements=function(){return e.get(this.namespace+"achievements")||{}}};return t.debug.log("SaveSystem loaded",3),i}),define("DE.Screen",["DE.CONFIG","DE.SaveSystem","DE.Event"],function(e,t,n){var r=new function(){this.DEName="Screen",this.screenSizes={},this.conceptionSizeIndex=0,this.ratioToConception=1,this.currentSizeIndex=0,this.activeScreenWidth=0,this.screenSize={w:0,h:0},this.dpiSizeRatio={w:0,h:0},this.dpi=1,this.init=function(e){e||console.log("%cFATAL ERROR %cyou need to pass the file containing all images datas when call DreamEngine.init","color:red;background:black","color: red"),this.screenSizes=e.screenSizes||[{w:1920
,h:1080,path:""}],this.conceptionSizeIndex=e.conceptionSizeIndex||0},this.updateScreenSizes=function(r){this.dpi=1;var i=i||1;i&&(this.dpi=i);var s=t.get("settings").quality||undefined,o=this.screenSizes;this.currentSizeIndex=0,this.screenSize.w=window.innerWidth||document.documentElement.clientWidth,this.screenSize.h=window.innerHeight||document.documentElement.clientHeight,this.dpiSizeRatio.w=(window.innerWidth||document.documentElement.clientWidth)/this.dpi>>0,this.dpiSizeRatio.h=(window.innerHeight||document.documentElement.clientHeight)/this.dpi>>0;if(o[r]||!isNaN(s)&&o[s])o[r]?(this.currentSizeIndex=r,t.get("settings").quality=r,t.save("settings",t.get("settings"))):this.currentSizeIndex=s||r;else{var u=0;for(var a=0;a<o.length;++a){this.currentSizeIndex=a;if(o[a].w<=this.screenSize.w&&o[a].h<=this.screenSize.h){if(a>0){var f=Math.abs(o[a].w-this.screenSize.w),l=Math.abs(o[a].h-this.screenSize.h),c=Math.abs(o[a-1].w-this.screenSize.w),h=Math.abs(o[a-1].h-this.screenSize.h);c<f&&h<
l&&(this.currentSizeIndex=a-1)}break}}t.get("settings").quality=r,t.save("settings",t.get("settings"))}this.activeScreenWidth=o[this.conceptionSizeIndex].w,e.debug.log("Choosen screen size index is "+this.currentSizeIndex+" - screenSize: "+JSON.stringify(this.screenSize)+" - choosedSize: "+JSON.stringify(o[this.currentSizeIndex])+" - dpi: "+this.dpi,2),this.ratioToConception=o[this.currentSizeIndex].w/o[this.conceptionSizeIndex].w,e.debug.log("Physical ratio is :: "+this.ratioToConception,2),n.trigger("updateScreenSizes",this.ratioToConception,o[this.currentSizeIndex])}};return e.debug.log("Screens loaded",3),r}),define("buzz",[],function(){var e={defaults:{autoplay:!1,duration:5e3,formats:[],loop:!1,placeholder:"--",preload:"metadata",volume:80,document:document},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(t,n){function a(e){var t=[],n=e.length-1;for(var r=0;r<=n;r++)t.push({start
:e.start(r),end:e.end(r)});return t}function f(e){return e.split(".").pop()}function l(t,n){var i=r.createElement("source");i.src=n,e.types[f(n)]&&(i.type=e.types[f(n)]),t.appendChild(i)}n=n||{};var r=n.document||e.defaults.document,i=0,s=[],o={},u=e.isSupported();this.load=function(){return u?(this.sound.load(),this):this},this.play=function(){return this.sound.isPreloaded?u?(this.sound.play(),this):this:(this.tryToPlay=!0,this)},this.togglePlay=function(){return this.sound.isPreloaded?u?(this.sound.paused?this.sound.play():this.sound.pause(),this):this:(this.tryToPlay=!0,this)},this.pause=function(){return u?(this.sound.pause(),this):this},this.isPaused=function(){return u?this.sound.paused:null},this.stop=function(){return u?(this.setTime(0),this.sound.pause(),this):this},this.isEnded=function(){return u?this.sound.ended:null},this.loop=function(){return u?(this.sound.loop="loop",this.bind("ended.buzzloop",function(){this.currentTime=0,this.play()}),this):this},this.unloop=function()
{return u?(this.sound.removeAttribute("loop"),this.unbind("ended.buzzloop"),this):this},this.mute=function(){return u?(this.sound.muted=!0,this):this},this.unmute=function(){return u?(this.sound.muted=!1,this):this},this.toggleMute=function(){return u?(this.sound.muted=!this.sound.muted,this):this},this.isMuted=function(){return u?this.sound.muted:null},this.setVolume=function(e){return u?(e<0&&(e=0),e>100&&(e=100),this.volume=e,this.sound.volume=e/100,this):this},this.getVolume=function(){return u?this.volume:this},this.increaseVolume=function(e){return this.setVolume(this.volume+(e||1))},this.decreaseVolume=function(e){return this.setVolume(this.volume-(e||1))},this.setTime=function(e){if(!u)return this;var t=!0;return this.whenReady(function(){t===!0&&(t=!1,this.sound.currentTime=e)}),this},this.getTime=function(){if(!u)return null;var t=Math.round(this.sound.currentTime*100)/100;return isNaN(t)?e.defaults.placeholder:t},this.setPercent=function(t){return u?this.setTime(e.fromPercent
(t,this.sound.duration)):this},this.getPercent=function(){if(!u)return null;var t=Math.round(e.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(t)?e.defaults.placeholder:t},this.setSpeed=function(e){return u?(this.sound.playbackRate=e,this):this},this.getSpeed=function(){return u?this.sound.playbackRate:null},this.getDuration=function(){if(!u)return null;var t=Math.round(this.sound.duration*100)/100;return isNaN(t)?e.defaults.placeholder:t},this.getPlayed=function(){return u?a(this.sound.played):null},this.getBuffered=function(){return u?a(this.sound.buffered):null},this.getSeekable=function(){return u?a(this.sound.seekable):null},this.getErrorCode=function(){return u&&this.sound.error?this.sound.error.code:0},this.getErrorMessage=function(){if(!u)return null;switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}},this.getStateCode=function(
){return u?this.sound.readyState:null},this.getStateMessage=function(){if(!u)return null;switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}},this.getNetworkStateCode=function(){return u?this.sound.networkState:null},this.getNetworkStateMessage=function(){if(!u)return null;switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}},this.set=function(e,t){return u?(this.sound[e]=t,this):this},this.get=function(e){return u?e?this.sound[e]:this.sound:null},this.bind=function(e,t){if(!u)return this;e=e.split(" ");var n=this,r=function(e){t.call(n,e)};for(var i=0;i<e.length;i++){var o=e[i],a=o;o=a.split(".")[0],s.push({idx:a,func:r}),this.sound.addEventListener(o,r,!0)}return this},this.unbind=function(e){if(!u)return this;e=e.
split(" ");for(var t=0;t<e.length;t++){var n=e[t],r=n.split(".")[0];for(var i=0;i<s.length;i++){var o=s[i].idx.split(".");if(s[i].idx==n||o[1]&&o[1]==n.replace(".",""))this.sound.removeEventListener(r,s[i].func,!0),s.splice(i,1)}}return this},this.bindOnce=function(e,t){if(!u)return this;var n=this;return o[i++]=!1,this.bind(e+"."+i,function(){o[i]||(o[i]=!0,t.call(n)),n.unbind(e+"."+i)}),this},this.trigger=function(e){if(!u)return this;e=e.split(" ");for(var t=0;t<e.length;t++){var n=e[t];for(var i=0;i<s.length;i++){var o=s[i].idx.split(".");if(s[i].idx==n||o[0]&&o[0]==n.replace(".","")){var a=r.createEvent("HTMLEvents");a.initEvent(o[0],!1,!0),this.sound.dispatchEvent(a)}}}return this},this.fadeTo=function(t,n,r){function a(){setTimeout(function(){i<t&&o.volume<t?(o.setVolume(o.volume+=1),a()):i>t&&o.volume>t?(o.setVolume(o.volume-=1),a()):r instanceof Function&&r.apply(o)},s)}if(!u)return this;n instanceof Function?(r=n,n=e.defaults.duration):n=n||e.defaults.duration;var i=this.volume
,s=n/Math.abs(i-t),o=this;return this.play(),this.whenReady(function(){a()}),this},this.fadeIn=function(e,t){return u?this.setVolume(0).fadeTo(100,e,t):this},this.fadeOut=function(e,t){return u?this.fadeTo(0,e,t):this},this.fadeWith=function(e,t){return u?(this.fadeOut(t,function(){this.stop()}),e.play().fadeIn(t),this):this},this.whenReady=function(e){if(!u)return null;var t=this;this.sound.readyState===0?this.bind("canplay.buzzwhenready",function(){e.call(t)}):e.call(t)};if(u&&t){for(var c in e.defaults)e.defaults.hasOwnProperty(c)&&(n[c]=n[c]||e.defaults[c]);this.sound=r.createElement("audio"),this.sound.oncanplaythrough=function(){this.oncanplaythrough=null,this.isPreloaded=!0,this.tryToPlay&&this.play()};if(t instanceof Array)for(var h in t)t.hasOwnProperty(h)&&l(this.sound,t[h]);else if(n.formats.length)for(var p in n.formats)n.formats.hasOwnProperty(p)&&l(this.sound,t+"."+n.formats[p]);else l(this.sound,t);n.loop&&this.loop(),n.autoplay&&(this.sound.autoplay="autoplay"),n.preload===!0?
this.sound.preload="auto":n.preload===!1?this.sound.preload="none":this.sound.preload=n.preload,this.setVolume(n.volume),e.sounds.push(this)}},group:function(e){function t(){var t=n(null,arguments),r=t.shift();for(var i=0;i<e.length;i++)e[i][r].apply(e[i],t)}function n(e,t){return e instanceof Array?e:Array.prototype.slice.call(t)}e=n(e,arguments),this.getSounds=function(){return e},this.add=function(t){t=n(t,arguments);for(var r=0;r<t.length;r++)e.push(t[r])},this.remove=function(t){t=n(t,arguments);for(var r=0;r<t.length;r++)for(var i=0;i<e.length;i++)if(e[i]==t[r]){e.splice(i,1);break}},this.load=function(){return t("load"),this},this.play=function(){return t("play"),this},this.togglePlay=function(){return t("togglePlay"),this},this.pause=function(e){return t("pause",e),this},this.stop=function(){return t("stop"),this},this.mute=function(){return t("mute"),this},this.unmute=function(){return t("unmute"),this},this.toggleMute=function(){return t("toggleMute"),this},this.setVolume=function(
e){return t("setVolume",e),this},this.increaseVolume=function(e){return t("increaseVolume",e),this},this.decreaseVolume=function(e){return t("decreaseVolume",e),this},this.loop=function(){return t("loop"),this},this.unloop=function(){return t("unloop"),this},this.setTime=function(e){return t("setTime",e),this},this.set=function(e,n){return t("set",e,n),this},this.bind=function(e,n){return t("bind",e,n),this},this.unbind=function(e){return t("unbind",e),this},this.bindOnce=function(e,n){return t("bindOnce",e,n),this},this.trigger=function(e){return t("trigger",e),this},this.fade=function(e,n,r,i){return t("fade",e,n,r,i),this},this.fadeIn=function(e,n){return t("fadeIn",e,n),this},this.fadeOut=function(e,n){return t("fadeOut",e,n),this}},all:function(){return new e.group(e.sounds)},isSupported:function(){return!!e.el.canPlayType},isOGGSupported:function(){return!!e.el.canPlayType&&e.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return!!e.el.canPlayType&&e.el.canPlayType
('audio/wav; codecs="1"')},isMP3Supported:function(){return!!e.el.canPlayType&&e.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return!!e.el.canPlayType&&(e.el.canPlayType("audio/x-m4a;")||e.el.canPlayType("audio/aac;"))},toTimer:function(e,t){var n,r,i;return n=Math.floor(e/3600),n=isNaN(n)?"--":n>=10?n:"0"+n,r=t?Math.floor(e/60%60):Math.floor(e/60),r=isNaN(r)?"--":r>=10?r:"0"+r,i=Math.floor(e%60),i=isNaN(i)?"--":i>=10?i:"0"+i,t?n+":"+r+":"+i:r+":"+i},fromTimer:function(e){var t=e.toString().split(":");return t&&t.length==3&&(e=parseInt(t[0],10)*3600+parseInt(t[1],10)*60+parseInt(t[2],10)),t&&t.length==2&&(e=parseInt(t[0],10)*60+parseInt(t[1],10)),e},toPercent:function(e,t,n){var r=Math.pow(10,n||0);return Math.round(e*100/t*r)/r},fromPercent:function(e,t,n){var r=Math.pow(10,n||0);return Math.round(t/100*e*r)/r}};return e}),define("DE.AudioManager",["DE.CONFIG","buzz","DE.Event"],function(e,t,n){var r=new function(){this.DEName="AudioManager",this.muted=!1,this.volume=80,this
.loadAudios=function(e){this.music.volume=this.volume,this.fx.volume=this.volume*.75;for(var n=0,r,i,s,o;n<e.length;++n)r=e[n],o=r[3]||{},i={},i.name=r[0]||"noname",i.preload=o.preload||!1,i.loop=o.loop||!1,i.formats=r[2]||["mp3"],i.autoplay=o.autoplay||!1,i.sound=new t.sound(r[1],{formats:i.formats,preload:i.preload,loop:i.loop,autoplay:i.autoplay}),o.isMusic?this.music.add(i):this.fx.add(i);this.setVolume(this.volume)},this.mute=function(){return this.music.mute(),this.fx.mute(),this.muted=!0,this},this.unmute=function(){return this.music.unmute(),this.fx.unmute(),this.muted=!1,this},this.toggle=function(){return this.muted?this.unmute():this.mute(),this},this.setVolume=function(e,t){t=="+"?this.volume+=e:t=="-"?this.volume-=e:this.volume=e,this.checkVolume();var n=this.volume;this.music.setVolume(n);var r=this.volume*.75;return this.fx.setVolume(r),this},this.checkVolume=function(){return this.volume=(this.volume>100?100:this.volume)>>0,this.volume=(this.volume<0?0:this.volume)>>0,this
},this.applyFades=function(){var e=this.music.getAll(),t,n=0;for(var r in e){if(e[r].sound.currentFade==0)continue;t=e[r].sound;for(var i in t.fades)n=t._volume+t.fades[i].dir*t.fades[i].step,++t.fades[i].step,t.volume(n,i!=="default"?i:null),n==t.fades[i].to&&(t.fades[i].callback&&t.fades[i].callback(),delete t.fades[i])}},this.music=new function(){var e={};this.volume=80,this.muted=!1,this.currentPlayed=[],this.getAll=function(){return e},this.get=function(t){return e[t].sound},this.add=function(t){e[t.name]=t},this.play=function(t){var n=[];t.length!=undefined&&t.push?n=t:n.push(t);for(var r=0,i;r<n.length;++r){i=n[r].split(".");var s=i[1]||null;i=i[0];if(!e[i]||!e[i].sound)continue;s?this.currentPlayed.push(i+"."+s):this.currentPlayed.push(i),e[i].sound.loop(),e[i].sound.setVolume(this.volume),this.muted||e[i].sound.play(s)}return this},this.stopAllAndPlay=function(e,t){return this.stopAll(t),this.play(e),this},this.stopAll=function(t){this.currentPlayed=[],t||(t=[]),t.push||(t=[t])
;for(var n in e){if(t.indexOf(n)!=-1){e[n].sound.isPaused()||this.currentPlayed.push(n);continue}e[n].sound.stop()}return this},this.pauseAll=function(t){this.currentPlayed=[],t||(t=[]),t.push||(t=[t]);for(var n in e){if(t.indexOf(n)!=-1){e[n].sound.isPaused()||this.currentPlayed.push(n);continue}e[n].sound.pause()}return this},this.pauseAllAndPlay=function(t){for(var n in e)e[n].sound.pause();if(this.muted)return;return this.play(t),this},this.mute=function(){return this.savedPlay=[].concat(this.currentPlayed),this.muted=!0,this.pauseAll(),this},this.unmute=function(){this.muted=!1;for(var t=0;t<this.savedPlay.length;++t)e[this.savedPlay[t]].sound.play();return this.currentPlayed=this.savedPlay,this},this.setVolume=function(t){this.volume=t||0;for(var n in e)e[n].sound.setVolume(this.volume);return this}},this.fx=new function(){var e={};this.volume=80,this.muted=!1,this.get=function(t){return e[t].sound},this.add=function(t){e[t.name]=t},this.play=function(t){if(this.muted)return;if(!e
[t]){console.log("Unable to find the fx named "+t+". Prevent play");return}return e[t].sound.isPaused()||e[t].sound.stop(),e[t].sound.play(),this},this.stop=function(t){e[t].sound.stop()},this.mute=function(){this.muted=!0;for(var t in e)e[t].sound.stop()},this.unmute=function(){return this.muted=!1,this},this.setVolume=function(t){this.volume=t||0;for(var n in e)e[n].sound.setVolume(this.volume);return this}}};return e.debug.log("AudioManager loaded",3),r}),define("DE.MainLoop",["DE.Time","DE.CONFIG","DE.States","DE.Inputs","DE.GamePad","DE.ImageManager","DE.SystemDetection","DE.Screen","DE.Event","DE.AudioManager"],function(e,t,n,r,i,s,o,u,a,f){var l=new function(){this.DEName="MainLoop",this.launched=!1,this.renders=new Array,this.scenes=new Array,this.maxRenders=1,this.loader=null,this.additionalModules={},this.loop=function(){if(!l.launched)return;requestAnimationFrame(l.loop);if(!e.update())return;if(n.get("isLoading")){if(!l.loader)return;var t=(s.imagesLoaded/s.imagesRequested*1e3>>0
)/10;t.toString().length>4&&(t=t.slice(0,4));for(var r=0,a;a=l.renders[r];r++)a.ctx.translate(a.sizes.width*.5,a.sizes.height*.5),l.loader.renderers[1].setText(t+"%"),l.loader.render(a.ctx,u.ratioToConception,{x:0,y:0,z:-10},{width:0,height:0},a.sizes.width/u.activeScreenWidth),a.ctx.translate(-a.sizes.width*.5,-a.sizes.height*.5);return}if(o.isOverridingMainLoop){if(!o.render)return;o.render.render(),o.scene.update(e.currentTime)}else if(n.get("isReady")){for(var r=0,a;a=l.renders[r];++r)a.render(),a.update();f.applyFades();while(e.missedFrame>=0){i.update(e.currentTime),l.customLoop(e.currentTime);for(var c in l.additionalModules)l.additionalModules[c].update(e.currentTime);for(r=0,a;a=l.scenes[r];++r)a.sleep||a.update();for(r=0,a;a=l.renders[r];++r)a.updateGuis();e.deltaTime=1,--e.missedFrame}}},this.addRender=function(e){e.id=this.maxRenders++,this.renders.push(e),e.fullScreenMode=="ratioStretch"&&e.screenChangedSizeIndex(u.ratioToConception,u.screenSizes[u.currentSizeIndex])},this.
screenChangedSizeIndex=function(e,t){for(var n=0,r;r=this.renders[n];++n)r.screenChangedSizeIndex(e,t)},this.addScene=function(e){this.scenes.push(e)},this.customLoop=function(e){}};return t.debug.log("MainLoop loaded",3),l}),define("DE.Scene",["DE.CONFIG","DE.COLORS","DE.GameObject","DE.Time","DE.MainLoop","DE.Event"],function(e,t,n,r,i,s){function o(t){this.name=t||"NoName-"+(Date.now()+Math.random()*Date.now()>>0),this.gameObjects=new Array,this.sleep=!1,this.maxObjects=0,this.timers=new Array,this.onGlobalMouseDown={},this.onLastGlobalMouseDown={},this.onGlobalMouseMove={},this.onLastGlobalMouseMove={},this.onGlobalMouseUp={},this.onLastGlobalMouseUp={},this.onGlobalMouseClick={},this.onLastGlobalMouseClick={},this._init=function(){i.addScene(this)},this.update=function(){if(this.sleep)return;for(var e=0,t=this.gameObjects.length,n;e<t;++e){n=this.gameObjects[e];if(!n)continue;if(n.flag!==null)switch(n.flag){case"delete":this.delete(e),--t;continue}n.update(r.currentTime)}for(var e=0
,t=this.timers.length;e<t;++tk)this.timers[e].update();this.waitSortGameObjects&&this.sortGameObjects()},this.sortGameObjects=function(){this.gameObjects.sort(function(e,t){return t.position.z==e.position.z?t.zindex==e.zindex?t.position.x-e.position.x:e.zindex-t.zindex:t.position.z-e.position.z});for(var e=0,t;t=this.gameObjects[e];++e)t.sortChildrens();this.waitSortGameObjects=!1},this.add=function(e){var t=Array.prototype.slice.call(arguments);for(var n=0;n<t.length;++n)if(t[n].length)for(var r=0,i=t[n].length||1;r<i;++r)this.addOne(t[n][r]);else this.addOne(t[n])},this.addOne=function(t){if(!(t instanceof n)){e.debug.log("%cIt's not or not herits from a GameObjects",1,"color:red");return}t.scene=this,this.gameObjects.push(t),++this.maxObjects,this.waitSortGameObjects=!0},s.addEventComponents(this),this._init()}return o.prototype=o.prototype||{},s.addEventCapabilities(o),o.prototype.cleanObjectBinding=function(e){delete this.onGlobalMouseDown[e.id],delete this.onLastGlobalMouseDown[e.
id],delete this.onGlobalMouseMove[e.id],delete this.onLastGlobalMouseMove[e.id],delete this.onGlobalMouseUp[e.id],delete this.onLastGlobalMouseUp[e.id]},o.prototype.remove=function(t){this.cleanObjectBinding(t);if(this.gameObjects[t])this.gameObjects.splice(t,1);else{var n=this.gameObjects.indexOf(t);if(n==-1){e.debug.log("%cRemove gameObject not found",1,"color:orange",t);return}this.gameObjects.splice(n,1)}this.maxObjects--},o.prototype.delete=function(e){this.gameObjects[e]?this.gameObjects[e].killMePlease():e.killMePlease(),this.remove(e)},o.prototype.deleteAll=function(){var e=this.gameObjects;while(e.length>0)this.delete(0);this.maxObjects=0},o.prototype.DEName="Scene",e.debug.log("Scene loaded",3),o}),define("DE.Rigidbody",["DE.Vector2","DE.CONFIG"],function(e,t){function n(t,n){n=n||{},this.gameObject=t,this.velocity=n.velocity||new e(n.initialVelocityX||0,n.initialVelocityY||0),this.mass=n.mass||0,this.isKinetic=!1,this.isTrigger=!1,this.addForce=function(){},this.addForceTo=function(
){}}return n.prototype=n.prototype||{},n.prototype.update=function(){},n.prototype.DEName="Rigidbody",t.debug.log("Rigidbody loaded",3),n}),define("DE.FixedBoxCollider",["DE.Collider","DE.COLORS","DE.CONFIG","DE.CanvasBuffer"],function(e,t,n,r){function i(i,s,o){o=o||{},o.type=n.COLLISION_TYPE.FIXED_BOX,e.call(this,o);var u=new Array,a=new Array,f=new Array;this.width=i||1,this.height=s||1,this.preventRotation=!0,this.localPosition.x-=this.width*.5,this.localPosition.y-=this.height*.5,this.createDebugRenderer=function(){this.debugBuffer=new r(this.width,this.height),this.debugBuffer.ctx.lineWidth=2,this.debugBuffer.ctx.strokeStyle=t.DEBUG.COLLIDER,this.debugBuffer.ctx.strokeRect(0,0,this.width,this.height)},this.debugRender=function(e,t,n){if(!this.debugBuffer)return;e.rotate(-this.gameObject.position.rotation),e.drawImage(this.debugBuffer.canvas,this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.debugBuffer.canvas.width*t*n>>0,this.debugBuffer.canvas.height*t*n>>0),e.rotate(this
.gameObject.position.rotation)},this.getRealPosition=function(){var e=this.gameObject.getPos(),t=this.gameObject.getHarmonics(),n=this.localPosition.x+this.width*.5,r=this.localPosition.y+this.height*.5;return{x:-(-n*t.cos+r*t.sin)+e.x-this.width*.5,y:-(-n*t.sin+r*-t.cos)+e.y-this.height*.5}},n.DEBUG_LEVEL>1&&this.createDebugRenderer()}return i.prototype=new e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype.DEName="FixedBoxCollider",n.debug.log("FixedBoxCollider loaded",3),i}),define("DE.OrientedBoxCollider",["DE.Collider","DE.CONFIG","DE.CanvasBuffer","DE.COLORS"],function(e,t,n,r){function i(i,s,o){o=o||{},o.type=t.COLLISION_TYPE.ORIENTED_BOX,e.call(this,o);var u=new Array,a=new Array,f={x:this.localPosition.x,y:this.localPosition.y,radius:undefined};this.width=i||1,this.height=s||1;var l=-this.width*.5,c=this.width*.5,h=-this.height*.5,p=this.height*.5;this.init=function(){u.push({x:l,y:h}),u.push({x:l,y:p}),u.push({x:c,y:p}),u.push({x:c,y:h});for(var e=0,n;n=u[e];
e++)n.ox=n.x,n.oy=n.y;var r=this.localPosition.x-(this.localPosition.x+u[0].x);r*=r;var i=this.localPosition.y-(this.localPosition.y+u[0].y);i*=i,f.radius=Math.sqrt(r+i);var s=this.width*.5;a.push({x:0,y:0,radius:s,isColliding:!1}),this.height<this.width&&(s=this.height*.5,a[0]={x:0,y:0,radius:s,isColliding:!1});var o=(this.width-s*2)/(s*2)/2,d=!0;o<=0&&(o=(this.height-s*2)/(s*2)/2,d=!1);if(o>0){o>>=0,o++;while(o>0)d?(a.push({x:-s+l+s*2*o,y:0,radius:s,isColliding:!1}),a.push({x:s-l-s*2*o,y:0,radius:s,isColliding:!1})):(a.push({x:0,y:-s+h+s*2*o,radius:s,isColliding:!1}),a.push({x:0,y:s-h-s*2*o,radius:s,isColliding:!1})),o--}t.DEBUG_LEVEL>1&&this.createDebugRenderer()},this.createDebugRenderer=function(){this.debugBuffer=new n(f.radius,f.radius),this.debugBuffer.ctx.lineWidth=2,this.debugBuffer.ctx.strokeStyle=r.DEBUG.COLLIDER,this.debugBuffer.ctx.strokeRect(0,0,this.width,this.height),this.debugBuffer.ctx.strokeStyle="blue",this.debugBuffer.ctx.beginPath(),this.debugBuffer.ctx.arc(this.localPosition
.x,this.localPosition.y,f.radius,0,Math.PI*2,!0),this.debugBuffer.ctx.stroke(),this.debugBuffer.ctx.closePath();for(var e=0,t;t=a[e];e++)this.debugBuffer.ctx.strokeStyle="blue",this.isColliding&&(this.debugBuffer.ctx.strokeStyle="green"),this.debugBuffer.ctx.beginPath(),this.debugBuffer.ctx.arc(this.localPosition.x+t.x,this.localPosition.y+t.y,t.radius,0,Math.PI*2,!0),this.debugBuffer.ctx.stroke(),this.debugBuffer.ctx.closePath();for(var e=0,i;i=u[e];e++)this.debugBuffer.ctx.strokeStyle="red",this.debugBuffer.ctx.fillRect(i.x-1,i.y-1,2,2)},this.debugRender=function(e){e.rotate(-this.gameObject.position.rotation),e.drawImage(this.debugBuffer.canvas,this.localPosition.x-this.debugBuffer.canvas.width*.5>>0,this.localPosition.y-this.debugBuffer.canvas.height*.5>>0),e.rotate(this.gameObject.position.rotation)},this.getExternCircle=function(){return f},this.getInternCircles=function(){return a},this.init()}return i.prototype=new e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype
.DEName="OrientedBoxCollider",t.debug.log("OrientedBoxCollider loaded",3),i}),define("DE.CircleCollider",["DE.Collider","DE.CONFIG","DE.CanvasBuffer","DE.COLORS"],function(e,t,n,r){function i(i,s){s=s||{},s.type=t.COLLISION_TYPE.CIRCLE,e.call(this,s),this.radius=i||1,this.createDebugRenderer=function(){this.debugBuffer=new n(this.radius*2,this.radius*2),this.debugBuffer.ctx.lineWidth=2,this.debugBuffer.ctx.strokeStyle=r.DEBUG.CIRCLE_COLLIDER,this.debugBuffer.ctx.beginPath(),this.debugBuffer.ctx.arc(this.radius,this.radius,this.radius,0,Math.PI*2,!0),this.debugBuffer.ctx.stroke(),this.debugBuffer.ctx.closePath()},this.debugRender=function(e,t,n){if(!this.debugBuffer)return;e.drawImage(this.debugBuffer.canvas,this.localPosition.x-this.debugBuffer.canvas.width*.5*t*n>>0,this.localPosition.y-this.debugBuffer.canvas.height*.5*t*n>>0,this.debugBuffer.canvas.width*t*n>>0,this.debugBuffer.canvas.height*t*n>>0)},t.DEBUG_LEVEL>1&&this.createDebugRenderer()}return i.prototype=new e,i.prototype.constructor=
i,i.prototype.supr=e.prototype,i.prototype.DEName="CircleCollider",t.debug.log("CircleCollider loaded",3),i}),define("DE.BoxRenderer.render",["DE.CONFIG"],function(e){function t(e,t,n){var r=e.globalAlpha;e.globalAlpha=this.alpha*r;switch(this.method){case"fill":this.fillIt(e,t,n);break;case"fillAndStroke":this.fillIt(e,t,n),this.strokeIt(e,t,n);break;case"stroke":this.strokeIt(e,t,n);break;default:this.strokeIt(e,t,n)}e.globalAlpha=r}return e.debug.log("BoxRenderer.render loaded",3),t}),define("DE.BoxRenderer",["DE.Renderer","DE.BoxRenderer.render","DE.CONFIG","DE.Sizes"],function(e,t,n,r){function i(t,n,i){e.call(this,t),this.sizes=new r(n,i,t.scaleX||t.scale||1,t.scaleY||t.scale||1,this),this.preventCenter=t.preventCenter||!1,this.preventCenter||this.sizes._center(),this.fillIt=function(e,t,n){e.fillStyle=this.fillColor,e.fillRect(this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.sizes.width*this.sizes.scaleX*t*n>>0,this.sizes.height*this.sizes.scaleY*t*n>>0)},this.strokeIt=
function(e,t,n){e.lineWidth=this.lineWidth,e.strokeStyle=this.strokeColor,e.strokeRect(this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.sizes.width*this.sizes.scaleX*t*n>>0,this.sizes.height*this.sizes.scaleY*t*n>>0)},this.setWidth=function(e){this.sizes.setSizes(e,this.sizes.height)},this.setHeight=function(e){this.sizes.setSizes(this.sizes.width,e)},this.setSizes=function(e,t){this.sizes.setSizes(e,t)}}return i.prototype=new e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype.DEName="BoxRenderer",i.prototype.render=t,n.debug.log("BoxRenderer loaded",3),i}),define("DE.CircleRenderer.render",["DE.CONFIG"],function(e){function t(e,t,n){var r=e.globalAlpha;e.globalAlpha=this.alpha*r,e.drawImage(this.buffer.canvas,this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.radius*2*t*n>>0,this.radius*2*t*n>>0),e.globalAlpha=r}return e.debug.log("CircleRenderer.render loaded",3),t}),define("DE.CircleRenderer",["DE.Renderer","DE.CircleRenderer.render","DE.CONFIG"
,"DE.CanvasBuffer"],function(e,t,n,r){function i(t,n,i,s,o){e.call(this,t),this.radius=n||1,this.angleStart=i||0,this.angleEnd=s||Math.PI*2,this.clockRotation=o||!1,this.buffer=null,this.preventCenter=t.preventCenter||!1,this.preventCenter||(this.localPosition.x-=this.radius,this.localPosition.y-=this.radius),this.initCircle=function(){this.buffer=new r(this.radius*2+this.lineWidth,this.radius*2+this.lineWidth),this.redraw()},this.redraw=function(){var e=this.buffer.ctx;e.clearRect(0,0,this.radius*2+this.lineWidth,this.radius*2+this.lineWidth),e.fillStyle=this.fillColor,e.lineWidth=this.lineWidth,e.strokeStyle=this.strokeColor,e.globalAlpha=this.alpha,e.beginPath(),e.arc(this.radius+this.lineWidth/2>>0,this.radius+this.lineWidth/2>>0,this.radius,this.angleStart,this.angleEnd,this.clockRotation);switch(this.method){case"fill":e.fill();break;case"fillAndStroke":e.fill(),e.stroke();break;case"stroke":e.stroke();break;default:e.stroke()}e.closePath()},this.initCircle()}return i.prototype=new 
e,i.prototype.constructor=i,i.prototype.supr=e.prototype,i.prototype.DEName="CircleRenderer",i.prototype.render=t,n.debug.log("CircleRenderer loaded",3),i}),define("DE.SpriteRenderer.render",["DE.ImageManager","DE.CONFIG","DE.Time"],function(e,t,n){function r(t,r,i){if(this.isAnimated&&!this.isPaused&&!this.isOver&&n.currentTime-this.lastAnim>this.eachAnim){var s=(n.currentTime-this.lastAnim)/this.eachAnim>>0;this.lastAnim=n.currentTime;while(s>0)this.isReversed?!this.isLoop&&this.currentFrame-1<this.startFrame?(this.isOver=!0,this.onAnimEnd()):this.currentFrame=this.currentFrame-1<this.startFrame?this.endFrame-1:this.currentFrame-1:!this.isLoop&&this.currentFrame+1>=this.endFrame?(this.isOver=!0,this.onAnimEnd()):this.currentFrame=this.currentFrame+1>=this.endFrame?this.startFrame:this.currentFrame+1,s--}var o=t.globalAlpha;t.globalAlpha=this.alpha*o,t.drawImage(e.images[this.spriteName],this.frameSizes.width*this.currentFrame,this.frameSizes.height*this.currentLine,this.frameSizes.width
,this.frameSizes.height,this.localPosition.x*i>>0,this.localPosition.y*i>>0,this.sizes.width*this.sizes.scaleX*i>>0,this.sizes.height*this.sizes.scaleY*i>>0),t.globalAlpha=o}return t.debug.log("SpriteRender.render loaded",3),r}),define("DE.SpriteRenderer",["DE.Renderer","DE.ImageManager","DE.Sizes","DE.SpriteRenderer.render","DE.CONFIG","DE.Time","DE.Event"],function(e,t,n,r,i,s,o){function u(r){if(!r)throw new Error("SpriteRenderer :: You have to pass arguments object to instantiate -- see the doc");e.call(this,r),this.spriteName=r.spriteName||undefined;if(!this.spriteName)throw new Error("SpriteRenderer :: No spriteName defined -- declaration canceled");if(!t.images[this.spriteName])throw new Error("SpriteRenderer :: Can't find image "+this.spriteName+" in imagesDatas");this.startFrame=r.startFrame||0,this.endFrame=r.endFrame||t.images[this.spriteName].totalFrame||0,this.totalFrame=t.images[this.spriteName].totalFrame||0,this.totalLine=r.totalLine||t.images[this.spriteName].totalLine||0
,this.eachAnim=r.eachAnim||t.images[this.spriteName].eachAnim||0,this.lastAnim=Date.now(),this.frameSizes=new n(t.images[this.spriteName].widthFrame,t.images[this.spriteName].heightFrame,1,1),r.scaleX=r.scale||r.scaleX||r.scalex||1,r.scaleY=r.scale||r.scaleY||r.scaley||1,this.sizes=new n(r.width||r.w||t.images[this.spriteName].widthFrame,r.height||r.h||t.images[this.spriteName].heightFrame,r.scaleX,r.scaleY,this),this.isAnimated=r.isAnimated||t.images[this.spriteName].isAnimated,this.isPaused=r.paused||r.isPaused,t.images[this.spriteName].isPaused||!1,this.isReversed=r.reversed||r.isreversed||r.isReversed||t.images[this.spriteName].isReversed||!1,this.isOver=!1,this.isLoop=r.isLoop!=undefined?r.isLoop:t.images[this.spriteName].isLoop,this.currentFrame=this.startFrame||0,this.startLine=r.startLine||0,this.currentLine=r.startLine||0,this.preventCenter=r.preventCenter||!1,this.preventCenter||this.sizes._center(),this.onAnimEnd=function(){},o.on("imageLoaded",function(e,n,r){if(r!=this.spriteName
)return;this.frameSizes.width=t.images[this.spriteName].widthFrame,this.frameSizes.height=t.images[this.spriteName].heightFrame,this.sizes.setSizes(this.frameSizes)},this)}return u.prototype=new e,u.prototype.constructor=u,u.prototype.supr=e.prototype,u.prototype.DEName="SpriteRenderer",u.prototype.render=r,u.prototype.setFrame=function(e){e+1>=this.endFrame?this.currentFrame=this.endFrame-1:e<this.startFrame?this.currentFrame=this.startFrame:this.currentFrame=e},u.prototype.setLine=function(e){e+1>=this.totalLine?this.currentLine=this.totalLine-1:this.currentLine=e},u.prototype.restartAnim=function(){this.isOver=!1,this.isReversed?this.currentFrame=this.endFrame-1:this.currentFrame=this.startFrame,this.lastAnim=s.currentTime},u.prototype.setPause=function(e,t){this.isPaused=e,!e&&!this.isAnimated&&(this.isAnimated=!0,this.lastAnim=Date.now())},u.prototype.setEndFrame=function(e){this.totalFrame<=e?this.endFrame=this.totalFrame-1:this.endFrame=e},u.prototype.setDelay=function(e){this.eachAnim=
e},u.prototype.setLoop=function(e){this.isLoop=e},u.prototype.changeSprite=function(e,r){r=r||{},this.spriteName=e,this.startFrame=r.startFrame||0,this.endFrame=r.endFrame||t.images[this.spriteName].totalFrame||0,this.totalFrame=t.images[this.spriteName].totalFrame||0,this.totalLine=r.totalLine||t.images[this.spriteName].totalLine||0,this.eachAnim=r.eachAnim||t.images[this.spriteName].eachAnim||0,this.lastAnim=Date.now(),this.frameSizes=new n(t.images[this.spriteName].widthFrame,t.images[this.spriteName].heightFrame,1,1),r.scaleX=r.scale||r.scaleX||r.scalex||1,r.scaleY=r.scale||r.scaleY||r.scaley||1,this.sizes._uncenter(),this.sizes=new n(r.width||r.w||t.images[this.spriteName].widthFrame,r.height||r.h||t.images[this.spriteName].heightFrame,r.scaleX,r.scaleY,this),this.sizes._center()},i.debug.log("SpriteRenderer loaded",3),u}),define("DE.Render",["DE.CONFIG","DE.Sizes","DE.Time","DE.MainLoop","DE.CollisionSystem","DE.Inputs","DE.CanvasBuffer"],function(e,t,n,r,i,s,o){function u(u,a){function c
(){return{x:document.scrollLeft||window.pageXOffset,y:document.scrollTop||window.pageYOffset}}function h(e,t,n){var r={x:e,y:t},i=this.canvas,s=0,o=0;while(i)s+=i.offsetLeft,o+=i.offsetTop,i=i.parentElement;return r.x-=s,r.y-=o,{x:r.x/f+c().x>>0,y:r.y/f+c().y>>0,index:n}}a=a||{},this.id=0,this.divId=u||undefined,this.canvas=null,this.ctx=null,this.sizes=new t(a.width||e.defaultRenderWidth||100,a.height||e.defaultRenderHeight||100,a.scaleX||1,a.scaleY||1),this.savedSizes=new t(a.width||e.defaultRenderWidth||100,a.height||e.defaultRenderHeight||100,a.scaleX||1,a.scaleY||1);var f=1;this.physicRatio=1,this.alpha=a.alpha||1,this.conserveSizes=a.conserveSizes||!1,this.fullScreenMode=a.fullScreen||null,this.cameras=new Array,this.maxCameras=0,this.events={},this.isFullscreen=!1,this.freeze=!1,this.init=function(){if(this.inited)return;r.addRender(this);if(!this.divId)this.div=window.document.body,e.debug.log("%cWARN: you not specified a DOM Object where push the render, it will push in the body *hiiik*"
,1,"color:orange");else{this.div=document.getElementById(this.divId);if(!this.div)throw new Error("Can't found the div by the given id")}this.canvas=document.createElement("canvas"),this.div.appendChild(this.canvas),s.addRender(this),this.ctx=this.canvas.getContext("2d"),this.buffer=new o(this.sizes.width,this.sizes.height),this.inited=!0,this.updateSizes();var t=this;this.div.addEventListener("fullscreenchange",function(e){t.isFullscreen=document.fullscreenElement},!1),this.div.addEventListener("msfullscreenchange",function(e){t.isFullscreen=document.msFullscreenElement},!1),this.div.addEventListener("mozfullscreenchange",function(e){t.isFullscreen=document.mozFullScreen},!1),this.div.addEventListener("webkitfullscreenchange",function(e){t.isFullscreen=document.webkitIsFullScreen},!1)},this.goFullscreen=function(){this.isFullscreen?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen
():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this.div.requestFullscreen?this.div.requestFullscreen():this.div.msRequestFullscreen?this.div.msRequestFullscreen():this.div.mozRequestFullScreen?this.div.mozRequestFullScreen():this.div.webkitRequestFullscreen&&this.div.webkitRequestFullscreen()},this.updateSizes=function(){if(!this.inited)return;this.conserveSizes?(this.sizes.width=this.div.offsetWidth.valueOf(),this.sizes.height=this.div.offsetHeight.valueOf()):(this.div.style.width=this.sizes.width+"px",this.div.style.height=this.sizes.height+"px"),this.canvas.width=this.sizes.width.valueOf(),this.canvas.height=this.sizes.height.valueOf(),this.canvas.id=this.id,this.fullScreenMode&&(this.fullScreen(this.fullScreenMode),this.resizeOnEventResize()),this.buffer.resize(this.sizes.width,this.sizes.height)},this.screenChangedSizeIndex=function(e,t){this.savedSizes.width=t.w,this.savedSizes.height=t.h,this.physicRatio=e,this.updateSizes();for(var n=0,r;r=this.cameras[n];++
n)r.screenChangedSizeIndex(e,t)},this.resize=function(e,t,n){this.div!=window.document.body&&(this.div.style.width=e+"px",this.div.style.height=t+"px"),this.canvas.width=e,this.canvas.height=t,this.sizes.width=e,this.sizes.height=t},this.resizeOnEventResize=function(){if(!this.fullScreenMode)return;var e=this,t=undefined,n=function(){e.fullScreenMethod.call(e)};window.addEventListener?window.addEventListener("resize",function(){t&&window.clearTimeout(t),t=window.setTimeout(n,200)},!1):window.attachEvent&&window.attachEvent("onresize",function(){t&&window.clearTimeout(t),t=window.setTimeout(n,200)})},this.resizeRatio=function(e,t,n){var r=this.savedSizes.width,i=this.savedSizes.height,s=e/r;s*i>t&&(s=t/i);var o=s*r>>0,u=s*i>>0;this.resize(o,u,n),this.isFullscreen?(this.div.style.marginLeft=0,this.div.style.marginTop=0):(this.div.style.marginLeft=(e-o)/2+"px",this.div.style.marginTop=(t-u)/2+"px"),f=o/this.savedSizes.width};var l;this.changeFullScreenMode=function(e){this.fullScreenMode=e
;switch(e){case"ratioStretch":l=function(e,t){this.resizeRatio(e,t,!0)};break;case"fullStretch":l=function(e,t){this.resize(e,t,!0)};break;case"ratio":l=function(e,t){this.resizeRatio(e,t,!1)};break;default:l=function(e,t){}}},this.fullScreenMethod=function(){var e=window.innerWidth||document.documentElement.clientWidth,t=window.innerHeight||document.documentElement.clientHeight,n=window.getComputedStyle(this.div.parentElement,null).getPropertyValue("height");if(this.div.parentElement!=null&&n&&t<document.body.clientHeight){var r=this.div.parentElement.innerWidth||this.div.parentElement.clientWidth,i=this.div.parentElement.innerHeight||this.div.parentElement.clientHeight;i<t&&(t=i),r<e&&(e=r)}if(!l)throw"Render.js : fullScreenMethod need a fullScreenMode, maybe you never used changeFullScreenMode";l.call(this,e,t)},this.fullScreen=function(e,t){e&&this.changeFullScreenMode(e),t,this.fullScreenMethod()},this.render=function(){if(this.freeze)return;this.ctx.globalAlpha=this.alpha,this.ctx
.fillStyle="black",this.ctx.fillRect(0,0,this.sizes.width,this.sizes.height);for(var t=0,r;r=this.cameras[t];++t)r.render(this.ctx,f,this.physicRatio);e.DEBUG_LEVEL>0&&(this.ctx.globalAlpha=1,this.ctx.font="24px Arial",this.ctx.fillStyle="white",this.ctx.fillText("DeltaTime: "+n.deltaTime,(this.sizes.width>>0)-220,30),this.ctx.fillText("MissedFrame: "+n.missedFrame,(this.sizes.width>>0)-220,60),this.ctx.fillText("FPS: "+n.fps,(this.sizes.width>>0)-220,90))},this.update=function(){if(this.freeze)return;for(var e in this.events)this.camerasMouseCollide.apply(this,this.events[e]),delete this.events[e]},this.updateGuis=function(){if(this.freeze)return;for(var e=0,t;t=this.cameras[e];++e)t.gui&&t.gui.update()},this.add=function(e){this.cameras.push(e),e.on("changeCursor",function(e){this.canvas.style.cursor=e},this),this.maxScenes++,e.screenChangedSizeIndex(this.physicRatio,this.savedSizes)},this.remove=function(t){var n=this.cameras.indexOf(t);if(n==-1){e.debug.log("Remove camera not found "
,1,t);return}this.cameras.splice(n,1),this.maxScenes--},this.camerasMouseCollide=function(e,t,n,r){var s=h.call(this,t,n,r);if(this["on"+e](s)||s.stopPropagation)return s;for(var o=0,u,a;o<this.cameras.length;o++){u=this.cameras[o];if(u.sleep)continue;a={x:u.renderPosition.x-u.renderSizes.width*.5*u.renderSizes.scaleX,y:u.renderPosition.y-u.renderSizes.height*.5*u.renderSizes.scaleY,width:u.renderSizes.width*u.renderSizes.scaleX,height:u.renderSizes.height*u.renderSizes.scaleY,enable:!0};if(i.pointFixedBoxCollision(s,a)){if(!u.indexMouseOver[r]&&u.oOnMouseEnter(s,this.physicRatio))break;if(u["oOn"+e](s,this.physicRatio))break}else if(u.indexMouseOver[r]&&u.oOnMouseLeave(s,this.physicRatio))break}return s.stopPropagation||this["lastOn"+e](s),s},this.onMouseMove=function(){},this.onMouseDown=function(){},this.onMouseUp=function(){},this.lastOnMouseMove=function(){},this.lastOnMouseDown=function(){},this.lastOnMouseUp=function(){},this.oOnMouseDown=function(e){this.events[Date.now()+"down"
]=["MouseDown",e.x,e.y,e.index]},this.oOnMouseUp=function(e){this.events[Date.now()+"up"]=["MouseUp",e.x,e.y,e.index]},this.oOnMouseMove=function(e){this.events[Date.now()+"move"]=["MouseMove",e.x,e.y,e.index]}}return u.prototype.DEName="Render",e.debug.log("Render loaded",3),u}),define("DE.Mid.gameObjectMouseEvent",["DE.CollisionSystem"],function(e){function t(n,r,i,s){if(!r.enable)return!1;var o=r.indexMouseOver[i.index];if(r.collider&&(r["onMouse"+n]||r.onMouseLeave||r.onMouseEnter)){if(e.checkCollisionWith(i,r.collider)){r.indexMouseOver[i.index]=!0,r.cursorOnOver&&(s.cursor="pointer");if(!o&&r.onMouseEnter&&r.onMouseEnter(i,s))return!0;if(r["onMouse"+n]&&r["onMouse"+n](i,s))return!0}else if(o){r.cursorOnOver&&(s.cursor="default"),r.indexMouseOver[i.index]=!1;if(r.onMouseLeave&&r.onMouseLeave(i,s))return!0}}else r.collider&&r.cursorOnOver&&(e.checkCollisionWith(i,r.collider)?(r.indexMouseOver[i.index]=!0,s.cursor="pointer"):o&&(r.indexMouseOver[i.index]=!1,s.cursor="default"));for(var u=
r.childrens.length-1,a;u>=0;--u)if(t(n,r.childrens[u],i,s))return!0}return t}),define("DE.Camera",["DE.CONFIG","DE.Sizes","DE.Vector2","DE.CanvasBuffer","DE.Mid.gameObjectMouseEvent","DE.ImageManager","DE.Event","DE.Time"],function(e,t,n,r,i,s,o,u){function a(e,i,s,u,a){a=a||{},this.name=a.name||"",this.tag=a.tag||"",this.scene=a.scene||null,this.gui=a.gui||undefined,this.renderSizes=new t(e,i,a.scale||a.scaleX||1,a.scale||a.scaleY||1),this.fieldSizes=new t(e,i,a.scale||a.scaleX||1,a.scale||a.scaleY||1),this.renderPosition=new n(s+e*.5,u+i*.5,a.z||-10),this.savedPosition=new n(s+e*.5,u+i*.5,a.z||-10),this.scenePosition=new n(a.realx||0,a.realy||0,a.realz||a.z||-10),this.limits={minX:a.minX!=undefined?a.minX:undefined,maxX:a.maxX!=undefined?a.maxX:undefined,minY:a.minY!=undefined?a.minY:undefined,maxY:a.maxY!=undefined?a.maxY:undefined},this.alpha=a.alpha||1,this.bufferAlpha=a.bufferAlpha||1,this.backgroundColor=a.backgroundColor||null,this.backgroundImage=a.backgroundImage||null,this.useTransparency=
a.useTransparency||a.transparent||!1,this.cameras=new Array,this.maxCameras=0,this.freeze=!1,this.sleep=!1,this.startX=0,this.startY=0,this._buffer=new r(this.renderSizes.width,this.renderSizes.height),this._visibleGameObjects=[],this.indexMouseOver={},this.lastPointersPos={},this._propagationEvent={},this.fadeData={from:1,to:0,duration:1e3,done:!0},this.fadeBufferData={from:1,to:0,duration:500,done:!0},o.addEventComponents(this)}return a.prototype.render=function(t,n,r){if(this.sleep)return;var i=t.globalAlpha,o=this._buffer;if(!this.freeze){this.applyFocus(),this.checkLimits(),this.applyShake(),o.ctx.globalAlpha=this.bufferAlpha*i,this.useTransparency&&o.ctx.clearRect(0,0,this.renderSizes.width,this.renderSizes.height),this.backgroundImage!=null?o.ctx.drawImage(s.images[this.backgroundImage],0,0,this.renderSizes.width,this.renderSizes.height):this.backgroundColor!=null&&(o.ctx.fillStyle=this.backgroundColor,o.ctx.fillRect(0,0,this.renderSizes.width,this.renderSizes.height)),o.ctx.save
();if(this.scene){var u=this.scene.gameObjects;this._visibleGameObjects=[];for(var a=0,f=u.length,l,c,h,p;a<f;a++)l=u[a],p=10/(l.position.z-this.scenePosition.z),c=l.position.x,h=l.position.y,p!=1&&(c=(l.position.x-(this.scenePosition.x+this.fieldSizes.width*.5))*p+(this.scenePosition.x+this.fieldSizes.width*.5),h=(l.position.y-(this.scenePosition.y+this.fieldSizes.height*.5))*p+(this.scenePosition.y+this.fieldSizes.height*.5)),l&&l.enable&&l.position.z>this.scenePosition.z&&c+l.biggerOffset.width>=this.scenePosition.x&&c-l.biggerOffset.width<=this.scenePosition.x+this.fieldSizes.width&&h+l.biggerOffset.height>=this.scenePosition.y&&h-l.biggerOffset.height<=this.scenePosition.y+this.fieldSizes.height&&(this._visibleGameObjects.push(l),l.render(o.ctx,r,this.scenePosition,this.fieldSizes))}else o.ctx.textAlign="center",o.ctx.fillStyle="white",o.ctx.fillText("No scene affiliated :(",this.renderSizes.width*.5,this.renderSizes.height*.5);o.ctx.restore(),o.ctx.globalAlpha=this.alpha*i,e.DEBUG&&
(o.ctx.fillStyle="white",o.ctx.textAlign="left",o.ctx.fillText("Camera "+this.name,10,20),o.ctx.strokeStyle="red",o.ctx.strokeRect(0,0,this.renderSizes.width>>0,this.renderSizes.height>>0),o.ctx.fillStyle="yellow",o.ctx.fillRect(this.renderSizes.width-10,this.renderSizes.height-10,10,10),o.ctx.fillRect(this.renderSizes.width-10,0,10,10),o.ctx.fillRect(0,this.renderSizes.height-10,10,10),o.ctx.fillRect(0,0,10,10),o.ctx.fillRect(this.renderSizes.width*.5,this.renderSizes.height*.5,20,5),o.ctx.fillRect(this.renderSizes.width*.5,this.renderSizes.height*.5,5,20)),this.applyFade()}t.translate(this.renderPosition.x*n>>0,this.renderPosition.y*n>>0),t.rotate(this.renderPosition.rotation),this.gui&&this.gui.render(o.ctx,n,r,this.renderSizes),t.globalAlpha=this.alpha,t.drawImage(o.canvas,-this.renderSizes.width*this.renderSizes.scaleX*n*.5>>0,-this.renderSizes.height*this.renderSizes.scaleY*n*.5>>0,this.renderSizes.width*this.renderSizes.scaleX*n>>0,this.renderSizes.height*this.renderSizes.scaleY*
n>>0),t.rotate(-this.renderPosition.rotation),t.translate(-this.renderPosition.x*n>>0,-this.renderPosition.y*n>>0),t.globalAlpha=i},a.prototype.checkLimits=function(){var e=this.limits;e.minX!=undefined&&this.scenePosition.x<e.minX?this.scenePosition.x=e.minX:e.maxX!=undefined&&this.scenePosition.x+this.renderSizes.width>e.maxX&&(this.scenePosition.x=e.maxX-this.renderSizes.width),e.minY!=undefined&&this.scenePosition.y<e.minY?this.scenePosition.y=e.minY:e.maxY!=undefined&&this.scenePosition.y+this.renderSizes.height>e.maxY&&(this.scenePosition.y=e.maxY-this.renderSizes.height)},a.prototype.screenChangedSizeIndex=function(e){this.renderSizes.width=this.fieldSizes.width*e>>0,this.renderSizes.height=this.fieldSizes.height*e>>0,this.renderPosition.x=this.savedPosition.x*e>>0,this.renderPosition.y=this.savedPosition.y*e>>0,this._buffer.canvas.width=this.renderSizes.width,this._buffer.canvas.height=this.renderSizes.height},a.prototype.add=function(e){this.cameras.push(e),++this.maxCameras},a
.prototype.remove=function(t){var n=this.cameras.indexOf(t);if(n==-1){e.debug.log("%cRemove camera not found ",1,"color:orange",t);return}this.cameras.splice(n,1),this.maxCameras--},a.prototype.applyFade=function(){if(!this.fadeData.done){this.fadeData.stepVal=u.timeSinceLastFrame/this.fadeData.oDuration*u.scaleDelta*this.fadeData.dir*this.fadeData.fadeScale,this.alpha+=this.fadeData.stepVal*u.scaleDelta,this.fadeData.duration-=u.timeSinceLastFrame*u.scaleDelta;if(this.fadeData.dir<0&&this.alpha<=this.fadeData.to||this.fadeData.dir>0&&this.alpha>=this.fadeData.to||this.alpha<0||this.alpha>1)this.alpha=this.fadeData.to;this.fadeData.duration<=0&&(this.trigger("fadeEnd"),this.fadeData.done=!0,(this.alpha==1||this.alpha==0)&&this.alpha==0&&(this.sleep=!0))}if(!this.fadeBufferData.done){this.fadeBufferData.stepVal=u.timeSinceLastFrame/this.fadeBufferData.oDuration*u.scaleDelta*this.fadeBufferData.dir*this.fadeBufferData.fadeScale,this.bufferAlpha+=this.fadeBufferData.stepVal*u.scaleDelta,this
.fadeBufferData.duration-=u.timeSinceLastFrame*u.scaleDelta;if(this.fadeBufferData.dir<0&&this.bufferAlpha<=this.fadeBufferData.to||this.fadeBufferData.dir>0&&this.bufferAlpha>=this.fadeBufferData.to||this.bufferAlpha<0||this.bufferAlpha>1)this.bufferAlpha=this.fadeBufferData.to;if(this.fadeBufferData.duration<=0){this.trigger("fadeBufferEnd"),this.fadeBufferData.done=!0;if(this.bufferAlpha==1||this.bufferAlpha==0)this.bufferAlpha==0&&(this.sleep=!0),this.useTransparency=this.oUseTransparency}}},a.prototype.fade=function(e,t,n,r){if(r&&t==this.bufferAlpha||t==this.alpha||this.alpha==0&&r)return;this.sleep=!1;var i={from:e||1,to:t!=undefined?t:0,duration:n||500,oDuration:n||500,fadeScale:Math.abs(e-t),done:!1};i.dir=i.from>t?-1:1,r?(this.fadeBufferData=i,this.oUseTransparency=this.useTransparency,this.useTransparency=!0):(this.alpha=e,this.fadeData=i)},a.prototype.fadeTo=function(e,t,n){this.sleep=!1,this.fade(this.alpha,e,t,n)},a.prototype.fadeOut=function(e,t){this.fade(this.alpha,0,e,
t)},a.prototype.fadeIn=function(e,t){this.fade(this.alpha,1,e,t)},a.prototype.shake=function(e,t,n){this.shakeData={duration:n||500,xRange:e,yRange:t,prevX:this.shakeData?this.shakeData.prevX:0,prevY:this.shakeData?this.shakeData.prevY:0}},a.prototype.applyShake=function(){if(!this.shakeData)return;var e=this.shakeData;this.scenePosition.x-=e.prevX,this.scenePosition.y-=e.prevY,this.shakeData.duration-=u.timeSinceLastFrame*u.scaleDelta;if(this.shakeData.duration<=0){delete this.shakeData;return}e.prevX=-(Math.random()*e.xRange)+Math.random()*e.xRange>>0,e.prevY=-(Math.random()*e.yRange)+Math.random()*e.yRange>>0,this.scenePosition.x+=e.prevX,this.scenePosition.y+=e.prevY},a.prototype.focus=function(e,t){t=t||{},this.target=e,this.focusLock=t.lock||{},this.focusOffset=t.offsets||{x:0,y:0}},a.prototype.applyFocus=function(){if(!this.target)return;var e=this.target.getPos();this.focusLock.x||(this.scenePosition.x=e.x-this.fieldSizes.width*.5),this.focusLock.y||(this.scenePosition.y=e.y-this
.fieldSizes.height*.5)},a.prototype.convertMousePos=function(e,t){e.x-=this.renderPosition.x-this.renderSizes.width*.5>>0,e.y-=this.renderPosition.y-this.renderSizes.height*.5>>0;var n=this.renderPosition.getHarmonics();if(n.sin==0&&n.cos==0)return this.renderSizes.scaleX!=1||this.renderSizes.scaleY!=1?{x:(e.x/t-(this.renderSizes.width-this.renderSizes.width*this.renderSizes.scaleX)/2)/this.renderSizes.scaleX>>0,y:(e.y/t-(this.renderSizes.height-this.renderSizes.height*this.renderSizes.scaleY)/2)/this.renderSizes.scaleY>>0,index:e.index}:{x:e.x/t>>0,y:e.y/t>>0,index:e.index};var r=this.renderSizes.width/2-e.x,i=this.renderSizes.height/2-e.y;return this.renderSizes.scaleX!=1||this.renderSizes.scaleY!=1?{x:((-(r*n.cos+i*n.sin)+this.renderSizes.width/2)/t-(this.renderSizes.width-this.renderSizes.width*this.renderSizes.scaleX)/2)/this.renderSizes.scaleX>>0,y:((r*n.sin+i*-n.cos+this.renderSizes.height/2)/t-(this.renderSizes.height-this.renderSizes.height*this.renderSizes.scaleY)/2)/this.renderSizes
.scaleY>>0,index:e.index,isDown:e.isDown}:{x:(-(r*n.cos+i*n.sin)+this.renderSizes.width/2)/t>>0,y:(r*n.sin+i*-n.cos+this.renderSizes.height/2)/t>>0,index:e.index,isDown:e.isDown}},a.prototype.onMouseDown=function(){},a.prototype.onMouseEnter=function(){},a.prototype.onMouseMove=function(){},a.prototype.onMouseLeave=function(){},a.prototype.onMouseUp=function(){},a.prototype.onMouseClick=function(){},a.prototype.onLastMouseMove=function(){},a.prototype.onLastMouseDown=function(){},a.prototype.onLastMouseUp=function(){},a.prototype.onLastMouseClick=function(){},a.prototype.oOnMouseDown=function(e,t){e.isDown=!0,e.date=Date.now(),this._propagationEvent[e.index]=e,this.mouseDetectorHandler("Down",e,t),this.trigger("changeCursor",this._propagationEvent[e.index].cursor||"default")},a.prototype.oOnMouseUp=function(t,n){Date.now()<this._propagationEvent[t.index].date+e.CLICK_DELAY&&this.mouseDetectorHandler("Click",t,n),this.mouseDetectorHandler("Up",t,n),this.trigger("changeCursor",this._propagationEvent
[t.index].cursor||"default"),this._propagationEvent[t.index]={}},a.prototype.oOnMouseMove=function(e,t){this._propagationEvent[e.index].index||(this._propagationEvent[e.index]=e),this.lastPointersPos[e.index]=e,this.indexMouseOver[e.index]=!0,this.mouseDetectorHandler("Move",e,t),this._propagationEvent[e.index]=this._propagationEvent[e.index]||{},this.trigger("changeCursor",this._propagationEvent[e.index].cursor||"default")},a.prototype.oOnMouseEnter=function(e,t){e=this.convertMousePos(e,t),this.onMouseEnter(e),this._propagationEvent[e.index]=this._propagationEvent[e.index]||{},this.trigger("changeCursor",this._propagationEvent[e.index].cursor||"default")},a.prototype.oOnMouseLeave=function(e,t){this.indexMouseOver[e.index]=!1,e=this.convertMousePos(e,t),this.onMouseLeave(e),this._propagationEvent[e.index]=this._propagationEvent[e.index]||{},this.trigger("changeCursor",this._propagationEvent[e.index].cursor||"default")},a.prototype.mouseDetectorHandler=function(e,t,n){if(this.freeze||this
.sleep||this._propagationEvent[t.index]["prevent"+e])return;t=this.convertMousePos(t,n),this.trigger("mouse"+e,t);if(this["onMouse"+e](t,this._propagationEvent[t.index])||t.stopPropagation)return;if(this.gui&&this.gui["oOnMouse"+e](t,this._propagationEvent[t.index])||t.stopPropagation)return;if(!this.scene.sleep){t.x+=this.scenePosition.x,t.y+=this.scenePosition.y;for(var r in this.scene["onGlobalMouse"+e])if(this.scene["onGlobalMouse"+e][r].enable&&this.scene["onGlobalMouse"+e][r]["onGlobalMouse"+e](t,this._propagationEvent[t.index]))return;for(var r=this._visibleGameObjects.length-1,s;r>=0;--r){s=this._visibleGameObjects[r];if(i(e,s,t,this._propagationEvent[t.index]))return}}if(!t.stopPropagation&&!this._propagationEvent[t.index]["preventLast"+e]){if(!this.scene.sleep){for(var r in this.scene["onLastGlobalMouse"+e])this.scene["onLastGlobalMouse"+e][r].enable&&this.scene["onLastGlobalMouse"+e][r]["onLastGlobalMouse"+e](t,this._propagationEvent[t.index]);t.x-=this.scenePosition.x,t.y-=this
.scenePosition.y}this.trigger("onLastMouse"+e,t,this._propagationEvent[t.index]),this.gui&&this.gui.oOnLastMouse(e,t,this._propagationEvent[t.index]),this["onLastMouse"+e](t,this._propagationEvent[t.index])}},o.addEventCapabilities(a),a.prototype.DEName="Camera",e.debug.log("Camera loaded",3),a}),define("DE.TextRenderer.render",["DE.CONFIG"],function(e){function t(e,t,n){var r=e.globalAlpha;e.globalAlpha=this.alpha*r,e.drawImage(this.buffer.canvas,this.localPosition.x*t*n>>0,this.localPosition.y*t*n>>0,this.sizes.width*this.sizes.scaleX*t*n>>0,this.sizes.height*this.sizes.scaleY*t*n>>0),e.globalAlpha=r}return e.debug.log("TextRenderer.render loaded",3),t}),define("DE.TextRenderer",["DE.Renderer","DE.TextRenderer.render","DE.CONFIG","DE.Sizes","DE.CanvasBuffer","DE.ImageManager"],function(e,t,n,r,i,s){function o(t,n,o,u){e.call(this,t);if(!t||!n||!o||u==undefined)throw new Error("TextRenderer :: Can't instantiate without params, width, height, text");this.text=u,this.textAlign=t.textAlign||"center"
,this.textBaseline=t.textBaseline||"middle",this.fontSize=t.fontSize||20,this.font=t.font||"Calibri",this.sizes=new r(n,o,1,1,this),this.preventCenter=t.preventCenter||!1,this.preventCenter||this.sizes._center(),this.paddingX=t.padding||t.paddingX||0,this.paddingY=t.padding||t.paddingY||0,this.backgroundColor=t.backgroundColor,this.borderColor=t.borderColor,this.borderSize=t.borderSize||1,this.backgroundImage=t.backgroundImage,this.backgroundImage&&!s.images[this.backgroundImage]&&(console.log("TextRenderer :: %cCant find given backgroundImage - "+this.backgroundImage+" check your imagesDatas - ignore background","color: red"),this.backgroundImage=undefined);if(this.backgroundImage||this.backgroundColor||this.borderColor)this.background=!0;this.init=function(){this.buffer=new i(this.sizes.width,this.sizes.height),this.clearBuffer()},this.clearBuffer=function(){this.buffer.ctx.clearRect(0,0,this.sizes.width,this.sizes.height),this.buffer.ctx.font=this.fontSize+"pt "+this.font,this.buffer
.ctx.textAlign=this.textAlign,this.buffer.ctx.textBaseline=this.textBaseline,this.background&&(this.backgroundImage?this.buffer.ctx.drawImage(s.images[this.backgroundImage],0,0,this.sizes.width,this.sizes.height):this.backgroundColor&&(this.buffer.ctx.fillStyle=this.backgroundColor,this.buffer.ctx.fillRect(0,0,this.sizes.width,this.sizes.height)),this.borderColor&&(this.buffer.ctx.lineWidth=this.borderSize,this.buffer.ctx.strokeStyle=this.borderColor,this.buffer.ctx.strokeRect(0,0,this.sizes.width,this.sizes.height),this.buffer.ctx.lineWidth=1));var e=this.textAlign=="right"?this.sizes.width-this.paddingX:this.textAlign=="left"?this.paddingX:this.sizes.width*.5+this.paddingX>>0,t=this.textBaseline=="bottom"?this.sizes.height-this.paddingY:this.textBaseline=="top"?this.paddingY:this.sizes.height*.5+this.paddingY>>0;if(this.method=="fill"||this.method=="fillAndStroke")this.buffer.ctx.fillStyle=this.fillColor,this.forceWidth?this.buffer.ctx.fillText(this.text,e,t,this.sizes.width):this.buffer
.ctx.fillText(this.text,e,t);if(this.method=="stroke"||this.method=="fillAndStroke")this.buffer.ctx.lineWidth=this.lineWidth,this.fillColor&&(this.buffer.ctx.globalAlpha=.8),this.buffer.ctx.strokeStyle=this.strokeColor,this.forceWidth?this.buffer.ctx.strokeText(this.text,e,t,this.sizes.width):this.buffer.ctx.strokeText(this.text,e,t)},this.setText=function(e){this.text=e,this.clearBuffer(),this.onSetText(e)},this.onSetText=function(e){},this.setSizes=function(e,t){this.sizes.setSizes(e,t)},this.init(t)}return o.prototype=new e,o.prototype.constructor=o,o.prototype.supr=e.prototype,o.prototype.DEName="TextRenderer",o.prototype.render=t,n.debug.log("TextRenderer loaded",3),o}),define("DE.TileRenderer.render",["DE.ImageManager","DE.CONFIG","DE.Time"],function(e,t,n){function r(t,n,r){var i=t.globalAlpha;t.globalAlpha=this.alpha*i,e.imageNotRatio?t.drawImage(e.images[this.imageName],this.tileposition.x*n>>0,this.tileposition.y*n>>0,this.tilesizes.width*n+1>>0,this.tilesizes.height*n+1>>0,this
.localPosition.x*n*r>>0,this.localPosition.y*n*r>>0,this.sizes.width*this.sizes.scaleX*n*r+2>>0,this.sizes.height*this.sizes.scaleY*n*r+1>>0):t.drawImage(e.images[this.imageName],this.tileposition.x,this.tileposition.y,this.tilesizes.width,this.tilesizes.height,this.localPosition.x*r>>0,this.localPosition.y*r>>0,this.sizes.width*this.sizes.scaleX*r>>0,this.sizes.height*this.sizes.scaleY*r>>0),t.globalAlpha=i}return t.debug.log("TileRenderer.render loaded",3),r}),define("DE.TileRenderer",["DE.Renderer","DE.ImageManager","DE.Vector2","DE.Sizes","DE.TileRenderer.render","DE.CONFIG"],function(e,t,n,r,i,s){function o(i){if(!i)throw new Error("TileRenderer :: You have to pass arguments object to instantiate -- see the doc");e.call(this,i),this.imageName=i.imageName||undefined;if(!this.imageName)throw new Error("TileRenderer :: No imageName defined -- declaration canceled");if(!t.images[this.imageName])throw new Error("TileRenderer :: Can't find image "+this.imageName+" in imagesDatas");i.tilesizes=
i.tilesizes||i.tileSizes||{},this.tilesizes=new r(i.tilesizes.width||i.tilesizes.w||i.width||10,i.tilesizes.height||i.tilesizes.h||i.height||10,1,1),i.tileposition=i.tileposition||i.tilePosition||{},this.tileposition=new n(i.tileposition.x||i.x||0,i.tileposition.y||i.y||0),this.tileposition||console.error("Tile position must be defined"),i.scaleX=i.scale||i.scaleX||i.scalex||1,i.scaleY=i.scale||i.scaleY||i.scaley||1,i.sizes=i.sizes||{},this.sizes=new r(i.sizes.width||i.width||i.w||i.tilesizes.width||10,i.sizes.height||i.height||i.h||i.tilesizes.height||10,i.scaleX,i.scaleY,this),this.preventCenter=i.preventCenter||!1,this.preventCenter||this.sizes._center()}return o.prototype=new e,o.prototype.constructor=o,o.prototype.supr=e.prototype,o.prototype.DEName="TileRenderer",o.prototype.render=i,s.debug.log("TileRenderer loaded",3),o}),define("DE.Gui",["DE.CONFIG","DE.COLORS","DE.Time","DE.Event","DE.GameObject","DE.CanvasBuffer","DE.Mid.gameObjectMouseEvent"],function(e,t,n,r,i,s,o){function u
(t){t=t||{},this.id=t.id||undefined,this.enable=t.enable!=undefined?t.enable:!0,this.alpha=t.alpha||1,this.gameObjects=t.gameObjects||[],this.timers=new Array,this.onGlobalMouseDown={},this.onLastGlobalMouseDown={},this.onGlobalMouseMove={},this.onLastGlobalMouseMove={},this.onGlobalMouseUp={},this.onLastGlobalMouseUp={},this.onGlobalMouseClick={},this.onLastGlobalMouseClick={},this.render=function(e,t,n,r){if(!this.enable)return;var i=e.globalAlpha;e.globalAlpha=i*this.alpha;for(var s=0;s<this.gameObjects.length;++s)this.gameObjects[s].render(e,n,{x:0,y:0,z:-10},r);e.globalAlpha=i},this.update=function(){if(this.sleep||!this.enable)return;for(var e=0,t=this.gameObjects.length,r;e<t;++e){r=this.gameObjects[e];if(!r)continue;if(r.flag!==null)switch(r.flag){case"delete":this.delete(e),--t;continue}r.update(n.currentTime)}for(var e=0,t=this.timers.length;e<t;++tk)this.timers[e].update();this.waitSortGameObjects&&this.sortGameObjects()},this.add=function(e){var t=Array.prototype.slice.call(
arguments);for(var n=0;n<t.length;++n)if(t[n].length)for(var r=0,i=t[n].length||1;r<i;++r)this.addOne(t[n][r]);else this.addOne(t[n])},this.addOne=function(t){if(!(t instanceof i)){e.debug.log("%cIt's not or not herits from a GameObjects",1,"color:red");return}t.scene=this,this.gameObjects.push(t),++this.maxObjects,this.waitSortGameObjects=!0},this.sortGameObjects=function(){this.gameObjects.sort(function(e,t){return t.zindex==e.zindex?t.position.x-e.position.x:e.zindex-t.zindex});for(var e=0,t;t=this.gameObjects[e];++e)t.sortChildrens();this.waitSortGameObjects=!1},this.onMouseMove=function(e){for(var t in this.components){if(!this.components[t].enable)continue;var n=this.components[t];if(n.checkState&&n.checkState(e))return n.onMouseMove(e),!0}return!1},r.addEventComponents(this)}return u.prototype=u.prototype||{},r.addEventCapabilities(u),u.prototype.onMouseDown=function(){},u.prototype.onMouseMove=function(){},u.prototype.onMouseUp=function(){},u.prototype.onMouseClick=function(){},
u.prototype.onLastMouseMove=function(){},u.prototype.onLastMouseDown=function(){},u.prototype.onLastMouseUp=function(){},u.prototype.onLastMouseClick=function(){},u.prototype.oOnMouseDown=function(e,t){return this.mainMouseHandler("Down",e,t)},u.prototype.oOnMouseMove=function(e,t){return this.mainMouseHandler("Move",e,t)},u.prototype.oOnMouseClick=function(e,t){return this.mainMouseHandler("Click",e,t)},u.prototype.oOnMouseUp=function(e,t){return this.mainMouseHandler("Up",e,t)},u.prototype.oOnLastMouse=function(e,t,n){this["onLastMouse"+e](t,n);for(var r in this["onLastGlobalMouse"+e])this["onLastGlobalMouse"+e][r].enable&&this["onLastGlobalMouse"+e][r]["onLastGlobalMouse"+e](t,n)},u.prototype.mainMouseHandler=function(e,t,n){if(this["onMouse"+e](t,n))return!0;for(var r in this["onGlobalMouse"+e])if(this["onGlobalMouse"+e][r].enable&&this["onGlobalMouse"+e][r]["onGlobalMouse"+e](t,n))return!0;if(!t.stopPropagation)for(var r=0,i;i=this.gameObjects[r];++r)if(o(e,i,t,n))return!0},u.prototype
.cleanObjectBinding=function(e){delete this.onGlobalMouseDown[e.id],delete this.onLastGlobalMouseDown[e.id],delete this.onGlobalMouseMove[e.id],delete this.onLastGlobalMouseMove[e.id],delete this.onGlobalMouseUp[e.id],delete this.onLastGlobalMouseUp[e.id]},u.prototype.remove=function(t){this.cleanObjectBinding(t);if(this.gameObjects[t])this.gameObjects.splice(t,1);else{var n=this.gameObjects.indexOf(t);if(n==-1){e.debug.log("%cRemove gameObject not found",1,"color:orange",t);return}this.gameObjects.splice(n,1)}this.maxObjects--},u.prototype.delete=function(e){this.gameObjects[e]?this.gameObjects[e].killMePlease():e.killMePlease(),this.remove(e)},u.prototype.deleteAll=function(){var e=this.gameObjects;while(e.length>0)this.delete(0);this.maxObjects=0},u.prototype.DEName="Gui",e.debug.log("Gui loaded",3),u}),define("DE.AchievementSystem",["stash","DE.CONFIG","DE.about","DE.Event","DE.AudioManager","DE.Notifications","DE.LangSystem","DE.SaveSystem"],function(e,t,n,r,i,s,o,u){var a=new function(
){this.DEName="AchievementSystem",this.achievements=[],this.userAchievements={},this.achievementsUrl="img/achievements/",this.init=function(e,t){this.achievements=[];for(var n=0,r;r=e[n];++n)this.achievements.push(r);this.userAchievements=t||u.loadAchievements()},this.checkEvent=function(e,t){for(var n=0,r,i;r=this.achievements[n];++n){i=this.userAchievements[r.namespace];for(var s in r.objectives){if(s!=e||i&&(i.complete||i.objectives[s]&&i.objectives[s].complete))continue;this.updateValue(r,s,t)}}u.saveAchievements(this.userAchievements)},this.updateValue=function(e,t,n){var r=e.objectives[t];if(!this.userAchievements[e.namespace]||!this.userAchievements[e.namespace].objectives)this.userAchievements[e.namespace]={objectives:{}};var i=this.userAchievements[e.namespace];switch(r.type){case"increment":i.objectives[t]||(i.objectives[t]={value:0}),i.objectives[t].value+=n||1;break;default:i.objectives[t]={value:n}}this.checkUnlock(e)},this.checkUnlock=function(e){var t=this.userAchievements
[e.namespace].objectives,n=e.objectives,r=!0,i,s;for(var o in n){if(!t[o]){r=!1;continue}if(t[o].complete)continue;i=n[o],s=!0;switch(i.type){case"egual":i.target!=t[o].value&&(s=!1);break;case"increment":case">=":i.target>t[o].value&&(s=!1)}s?t[o].complete=!0:r=!1}r&&this.unlocked(e)},this.unlocked=function(e){this.userAchievements[e.namespace].complete=!0;var n=e.names[o.currentLang]||e.names.en||"null",r=this.achievementsUrl+e.namespace+".png",u=o.get("achievement-unlock").replace(/%name%/gi,n).replace(/%path%/gi,r);s.create(u,t.notifications.achievementUnlockDuration),i.fx.play("achievement-unlocked")},r.on("games-datas",this.checkEvent,this)};return a}),define("NebulaOffline",["DE.about","DE.Event","DE.Inputs","DE.SaveSystem","DE.LangSystem","DE.Notifications","DE.AchievementSystem"],function(about,Event,Inputs,SaveSystem,LangSystem,Notifications,AchievementSystem){var _offLineTemplate="<div class='centeredModal'><div class='close'>X</div><h3 class='title'></h3><p class='about'></p><div class='btns'><button class='yesLoad'></button><button class='noLoad'></button></div></div>"
,_offLineVignet="<div class='vignet'>Op</div>",_langs={en:{"nebula-bad-namespace":"No namespace given for the game, disable Nebula or set a valid namespace in about","nebula-title":"Connect to Nebula system","nebula-description":"Login to synchronize and save your progressions on Dreamirl's servers, you'll synchronize the same progression on your mobile, computer, laptop, whatever!<br />No registered ? You can do it from interface, click Login.","nebula-login":"Login","nebula-nop":"No thank you","nebula-firewall":"Cannot load, seems you firewall block connexion, or server is down"},fr:{"nebula-bad-namespace":"Aucun namespace valide n'a \u00e9t\u00e9 trouv\u00e9, d\u00e9sactivation du module Nebula (vous pouvez aussi le d\u00e9sactiver automatiquement)","nebula-title":"Connexion au syst\u00e8me Nebula","nebula-description":"Connectez vous pour synchroniser et sauvegarder votre progression sur les serveur Dreamirl, vous pourrez ainsi conserver le m\u00eame avancement sur votre mobile, votre pc ou votre pc portable !<br />Pas inscrit ? Vous pouvez le faire depuis l'interface!"
,"nebula-login":"Se connecter","nebula-nop":"Non merci","nebula-firewall":"Chargement impossible, il semble que votre pare-feu bloque la connexion, ou le serveur est down"}},NebulaOffline=new function(){var _self=this;this.el=null,this.container=null,this.isNebula=!0,this.init=function(e){_langs[LangSystem.currentLang]||(_langs[LangSystem.currentLang]={});if(!about.namespace){alert(_langs[LangSystem.currentLang]["nebula-bad-namespace"]||_langs.en["nebula-bad-namespace"]);return}var t=document.getElementById(e||"Dreamirl-Nebula");t||(t=document.body);var n=document.createElement("div");n.id="NebulaClient",n.innerHTML=_offLineTemplate,this.elParent=t,t.appendChild(n),n.getElementsByClassName("title")[0].innerHTML=_langs[LangSystem.currentLang]["nebula-title"]||_langs.en["nebula-title"],n.getElementsByClassName("about")[0].innerHTML=_langs[LangSystem.currentLang]["nebula-description"]||_langs.en["nebula-description"];var r=n.getElementsByClassName("yesLoad")[0];r.innerHTML=_langs[LangSystem
.currentLang]["nebula-login"]||_langs.en["nebula-login"],r.addEventListener("click",function(e){_self.loadClient()},!0);var i=n.getElementsByClassName("noLoad")[0];i.innerHTML=_langs[LangSystem.currentLang]["nebula-nop"]||_langs.en["nebula-nop"],i.addEventListener("click",function(e){_self.hide()},!0),n.getElementsByClassName("close")[0].addEventListener("click",function(){_self.hide()},!0),this.container=n;var s=document.createElement("div");s.id="NebulaVignet",s.innerHTML="OP",t.appendChild(s),this.vignet=s,s.addEventListener("click",function(){_self.show()},!0),Event.trigger("nebula-show"),Event.on("close-nebula",this.hide,this),Event.on("toggle-nebula",function(){this.visible?this.hide():this.show()},this),this.show()},this.hide=function(){this.visible=!1,Event.trigger("nebula-hide"),_self.container.className+=_self.container.className+=" fading",setTimeout(function(){_self.container.className+=" hided"},200)},this.show=function(){this.visible=!0,Event.trigger("nebula-show"),_self.container
.className=_self.container.className.replace(/hided/gi,"").replace(/  /gi,""),setTimeout(function(){_self.container.className=_self.container.className.replace(/fading/gi,"")},50),setTimeout(function(){_self.container.className=_self.container.className.replace(/hided/gi,"")},250)},this.loadClient=function(){if(window.Nebula){window.Nebula.init();return}var e=document.createElement("script");e.type="text/javascript",e.src="http://dreamirl.com/Nebula.js?r="+Date.now(),e.pointer=this,document.body.appendChild(e),e.onload=this.onLoadClient,e.onerror=function(){alert(_langs[LangSystem.currentLang]["nebula-firewall"]||_langs.en["nebula-firewall"]),_self.hide()}},this.onLoadClient=function(e){console.log("%cGet Nebula !","color:green"),window.NebulaReady=function(){window.Nebula.init(about,Event,Inputs,SaveSystem,Notifications,AchievementSystem)},e&&eval('require( [ "Nebula" ] )')}};return NebulaOffline}),define("DREAM_ENGINE",["DE.CONFIG","DE.COLORS","DE.Time","DE.Vector2","DE.Sizes","DE.ImageManager"
,"DE.CollisionSystem","DE.Collider","DE.Renderer","DE.Scene","DE.Rigidbody","DE.CanvasBuffer","DE.GameObject","DE.FixedBoxCollider","DE.OrientedBoxCollider","DE.CircleCollider","DE.BoxRenderer","DE.CircleRenderer","DE.SpriteRenderer","DE.Render","DE.MainLoop","DE.Event","DE.States","DE.Inputs","DE.Camera","DE.TextRenderer","DE.TileRenderer","DE.AudioManager","DE.Gui","DE.LangSystem","DE.SystemDetection","DE.GamePad","DE.Screen","DE.about","DE.SaveSystem","DE.Notifications","NebulaOffline","DE.AchievementSystem"],function(){var e={},t=null,n=Date.now();for(var r in arguments){if(arguments[r].isNebula){t=arguments[r];continue}var i=arguments[r],s=i.DEName;!s&&i.prototype&&(s=i.prototype.DEName);if(!s){console.log("%cNo name for "+r,"color:red",arguments[r]);continue}e[s]=arguments[r],delete e[s].DEName}return e.init=function(r){r=r||{},r.loader=r.loader||{},r.loader.name=r.loader.name||"loader",r.loader.url=r.loader.url||"loader",r.loader.totalFrame=r.loader.totalFrame||16,r.loader.eachAnim=
r.loader.eachAnim||45,r.loader.ext=r.loader.ext||"png",r.loader.isAnimated=!0,r.loader.scale=r.loader.scale||1,window.ENGINE_SETTING=window.ENGINE_SETTING||{},e.about.set(r.about),e.SaveSystem.init(r.saveModel,r.saveIgnoreVersion),e.LangSystem.init(r.dictionary||{}),e.SystemDetection.initSystem(r.system,r.paramsSystem||{}),e.AchievementSystem.init(r.achievements||[]),e.on("updateScreenSizes",function(e,t){this.ImageManager.pathPrefix=t.path,this.ImageManager.imageNotRatio=t.notRatio||!1,this.ImageManager.ratioToConception=e,this.ImageManager.arrayLoader(r.images.imagesList),this.MainLoop.screenChangedSizeIndex(e,t)},e),e.on("updateScreenSizes",function(){this.ImageManager.folderName=r.images.folderName,this.ImageManager.pushImage(r.loader.name,r.loader.url,r.loader.ext,r.loader)},e,!1),r.ignoreNotification||e.Notifications.init(r),e.GamePad.init(),e.pause=function(){this.on("isReady",function(){this.MainLoop.launched=!0,this.MainLoop.loop(),this.paused&&(this.MainLoop.launched=!1,this.Inputs
.keyLocked=!0)},this),this.MainLoop.launched=!1,this.Inputs.keyLocked=!0,this.paused=!0},e.unPause=function(){this.Inputs.keyLocked=!1,this.paused=!1,this.Time.lastCalcul=Date.now(),this.MainLoop.launched=!0,this.MainLoop.loop()},e.on("notisLoadingImages",function(){r.ignoreNebula||(this.on("nebula-hide",this.unPause,this),this.on("nebula-show",this.pause,this),t.init(r.nebulaElementId)),e.MainLoop.loader=new e.GameObject({renderers:[new e.SpriteRenderer({spriteName:"loader",scale:r.loader.scale}),new e.TextRenderer({fillColor:r.loader.fillColor||"#FFFFFF",strokeColor:r.loader.strokeColor||"#FBC989",fontSize:r.loader.fontSize||32,lineWidth:r.loader.lineWidth||2,offsetY:220+(r.loader.offsetY||0),offsetX:0+(r.loader.offsetX||0),font:r.loader.font||"Helvetica"},400,100,"100%")]}),r.onReady?r.onReady():console.log("%cNo initialisation function given","color:red"),r.onStart?e.Event.on("isReady",function(){var t=Date.now()-n;t>=5e3?(r.onStart(),e.SystemDetection.askToRate()):(e.CONFIG.debug.log
("start in ",1e3-t,"ms"),setTimeout(function(){r.onStart(),e.SystemDetection.askToRate()},1e3-t))},e,!1):console.log("%cNo start function given","color:red"),e.ImageManager.arrayLoader(r.images.imagesList),e.AudioManager.loadAudios(r.audios),e.Inputs.init(r.inputs),r.customLoop&&(e.MainLoop.customLoop=r.customLoop)},e,!1),e.Screen.init(r.images),e.Screen.updateScreenSizes(ENGINE_SETTING.quality)},e.start=function(){e.States.up("isInited"),this.MainLoop.launched=!0,this.MainLoop.loop()},e.on=function(){this.Event.on.apply(this.Event,arguments)},e.trigger=function(){this.Event.trigger.apply(this.Event,arguments)},e.deltaTime=e.Time.getDelta(),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e}),require(["DREAM_ENGINE","main"],function(e,t){return t(e),e}
);